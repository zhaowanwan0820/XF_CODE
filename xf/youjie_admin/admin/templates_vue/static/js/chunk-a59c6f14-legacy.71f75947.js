(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-a59c6f14"],{"21a6":function(e,t,n){(function(n){var o,i,a;(function(n,r){i=[],o=r,a="function"===typeof o?o.apply(t,i):o,void 0===a||(e.exports=a)})(0,function(){"use strict";function t(e,t){return"undefined"==typeof t?t={autoBom:!1}:"object"!=typeof t&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e}function o(e,t,n){var o=new XMLHttpRequest;o.open("GET",e),o.responseType="blob",o.onload=function(){l(o.response,t,n)},o.onerror=function(){console.error("could not download file")},o.send()}function i(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return 200<=t.status&&299>=t.status}function a(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(o){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var r="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof n&&n.global===n?n:void 0,l=r.saveAs||("object"!=typeof window||window!==r?function(){}:"download"in HTMLAnchorElement.prototype?function(e,t,n){var l=r.URL||r.webkitURL,s=document.createElement("a");t=t||e.name||"download",s.download=t,s.rel="noopener","string"==typeof e?(s.href=e,s.origin===location.origin?a(s):i(s.href)?o(e,t,n):a(s,s.target="_blank")):(s.href=l.createObjectURL(e),setTimeout(function(){l.revokeObjectURL(s.href)},4e4),setTimeout(function(){a(s)},0))}:"msSaveOrOpenBlob"in navigator?function(e,n,r){if(n=n||e.name||"download","string"!=typeof e)navigator.msSaveOrOpenBlob(t(e,r),n);else if(i(e))o(e,n,r);else{var l=document.createElement("a");l.href=e,l.target="_blank",setTimeout(function(){a(l)})}}:function(e,t,n,i){if(i=i||open("","_blank"),i&&(i.document.title=i.document.body.innerText="downloading..."),"string"==typeof e)return o(e,t,n);var a="application/octet-stream"===e.type,l=/constructor/i.test(r.HTMLElement)||r.safari,s=/CriOS\/[\d]+/.test(navigator.userAgent);if((s||a&&l)&&"object"==typeof FileReader){var u=new FileReader;u.onloadend=function(){var e=u.result;e=s?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),i?i.location.href=e:location=e,i=null},u.readAsDataURL(e)}else{var p=r.URL||r.webkitURL,c=p.createObjectURL(e);i?i.location=c:location.href=c,i=null,setTimeout(function(){p.revokeObjectURL(c)},4e4)}});r.saveAs=l.saveAs=l,e.exports=l})}).call(this,n("c8ba"))},"278b":function(e,t,n){"use strict";var o=n("e646"),i=n.n(o);i.a},"5d6b":function(e,t,n){var o=n("e53d").parseInt,i=n("a1ce").trim,a=n("e692"),r=/^[-+]?0[xX]/;e.exports=8!==o(a+"08")||22!==o(a+"0x16")?function(e,t){var n=i(String(e),3);return o(n,t>>>0||(r.test(n)?16:10))}:o},"5d78":function(e,t,n){"use strict";n.r(t);var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"container"},[n("page-title",{attrs:{"first-title":"push管理","second-title":e.id?"编辑":"新增"}}),n("div",{staticClass:"foem-wrapper"},[n("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"150px",disabled:e.isCheck}},[n("el-form-item",{attrs:{label:"标题",prop:"title"}},[n("el-input",{model:{value:e.form.title,callback:function(t){e.$set(e.form,"title",t)},expression:"form.title"}})],1),n("el-form-item",{attrs:{label:"内容",prop:"content"}},[n("el-input",{staticClass:"text-area",attrs:{type:"textarea"},model:{value:e.form.content,callback:function(t){e.$set(e.form,"content",t)},expression:"form.content"}})],1),n("el-form-item",{attrs:{label:"目标人群",prop:"push_type"}},[n("el-radio-group",{on:{change:e.pushType},model:{value:e.form.push_type,callback:function(t){e.$set(e.form,"push_type",t)},expression:"form.push_type"}},[n("el-radio",{attrs:{label:!1}},[e._v("指定用户")]),n("el-radio",{attrs:{label:!0}},[e._v("全部用户")])],1)],1),e.form.push_type?e._e():n("el-form-item",{attrs:{label:"用户列表",prop:"file_path",required:""}},[n("el-upload",{attrs:{action:e.uploadUrl,headers:e.headers,name:"myfile",accept:"application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","on-success":e.uploadSuccess,"show-file-list":!1,"with-credentials":!0}},[n("el-button",{attrs:{slot:"trigger",type:"primary",size:"small",icon:"el-icon-upload2"},slot:"trigger"},[e._v("批量导入")])],1),n("el-button",{attrs:{type:"text",size:"small"},on:{click:e.download}},[e._v("下载模板")]),void 0!==e.uploadCount?n("p",{staticClass:"upload-count"},[e._v("已导入用户数："+e._s(e.uploadCount))]):e._e()],1),n("el-form-item",{attrs:{label:"发送时间",prop:"push_time_type"}},[n("el-radio-group",{on:{change:e.timeTypeChange},model:{value:e.push_time_type,callback:function(t){e.push_time_type=t},expression:"push_time_type"}},[n("el-radio",{attrs:{label:!0}},[e._v("定时发送")]),n("el-radio",{attrs:{label:!1}},[e._v("即时发送")])],1)],1),e.push_time_type?n("el-form-item",{attrs:{label:"定时发送时间",prop:"plan_exe_time"}},[n("el-date-picker",{attrs:{type:"datetime",placeholder:"请选择发送时间"},model:{value:e.form.plan_exe_time,callback:function(t){e.$set(e.form,"plan_exe_time",t)},expression:"form.plan_exe_time"}})],1):e._e(),n("el-form-item",{attrs:{label:"链接地址",prop:"go_url"}},[n("el-input",{model:{value:e.form.go_url,callback:function(t){e.$set(e.form,"go_url",t)},expression:"form.go_url"}})],1),n("el-form-item",[n("el-button",{attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v("立即创建")]),n("el-button",{on:{click:e.goBack}},[e._v("取消")])],1)],1)],1)],1)},i=[],a=n("cebc"),r=n("e814"),l=n.n(r),s=n("21a6"),u=n("822c"),p={name:"pushEdit",data:function(){var e=this,t=function(t,n,o){if(e.push_time_type){if(!n)return o(new Error("请选择发送时间"));var i=(new Date).getTime(),a=n.getTime();if(a<i)return o(new Error("定时发送时间不得早于当前时间"))}return o()},n=function(t,n,o){return e.push_type||e.filePath?o():o(new Error("请上传用户手机号文件"))};return{id:this.$route.query.id,isCheck:!!this.$route.query.isCheck,form:{title:"",content:"",plan_exe_time:"",push_type:!1,file_path:"",go_url:""},loading:!1,push_time_type:!1,uploadUrl:"".concat("https://api.youjiemall.com","/admin/api.app.push.lead"),filePath:"",uploadCount:void 0,rules:{title:[{required:!0,message:"请输入标题",trigger:"blur"},{max:15,message:"长度不超过15个字符",trigger:"blur"}],content:[{required:!0,message:"请填写推送内容",trigger:"blur"},{max:100,message:"长度不超过100个字符",trigger:"blur"}],go_url:[{required:!0,message:"请填写链接地址",trigger:"blur"}],plan_exe_time:[{required:!0,message:"请选择推送时间",trigger:"blur"},{validator:t,trigger:"blur"}],file_path:[{validator:n,message:"指定人群发送必须上传用户手机号",trigger:"blur"}]}}},computed:{headers:function(){var e="";return e=window.token,{"X-ADMIN-Authorization":e,"X-HH-Ver":"0.4.3"}}},created:function(){this.id&&this.getDetail()},methods:{onSubmit:function(){var e=this;this.$refs["form"].validate(function(t){if(!t)return!1;var n={title:e.form.title,content:e.form.content,go_url:e.form.go_url,push_type:e.form.push_type?1:0,push_time_type:e.push_time_type?1:0};e.id&&(n.id=e.id),e.form.push_type||(n.file_path=e.filePath),e.push_time_type&&(n.plan_exe_time=l()(e.form.plan_exe_time.getTime()/1e3)),e.saveRecord(n)})},saveRecord:function(e){var t=this;Object(u["c"])(e).then(function(e){t.$router.go(-1)})},getDetail:function(){var e=this;this.loading=!0,Object(u["d"])(this.id).then(function(t){e.loading=!1,e.form=Object(a["a"])({},t),e.form.plan_exe_time=e.form.plan_exe_time?new Date(1e3*e.form.plan_exe_time):new Date,e.form.push_type=1==e.form.push_type,e.push_time_type=!!e.form.push_time_type})},pushType:function(e){this.uploadCount=void 0,this.filePath=""},timeTypeChange:function(e){this.form.plan_exe_time=""},uploadSuccess:function(e,t,n){0==e.code&&(this.uploadCount=e.data.count,this.filePath=e.data.file_path)},goBack:function(){this.$router.go(-1)},download:function(){Object(u["b"])().then(function(e){Object(s["saveAs"])(new Blob([e.data]),e.filename||"app_push.xls")})}},watch:{filePath:function(e){this.form.file_path=e}}},c=p,f=(n("278b"),n("2877")),d=Object(f["a"])(c,o,i,!1,null,"32f8640a",null);t["default"]=d.exports},7445:function(e,t,n){var o=n("63b6"),i=n("5d6b");o(o.G+o.F*(parseInt!=i),{parseInt:i})},"822c":function(e,t,n){"use strict";n.d(t,"e",function(){return i}),n.d(t,"a",function(){return a}),n.d(t,"d",function(){return r}),n.d(t,"c",function(){return l}),n.d(t,"b",function(){return s});var o=n("65c6"),i=function(e){var t={page:e.page,size:e.size,title:e.title,exe_time_start:e.start,exe_time_end:e.end};return"number"==typeof e.exe_code&&(t.exe_code=e.exe_code),Object(o["a"])("/admin/api.app.push.list","POST",t)},a=function(e){return Object(o["a"])("/admin/api.app.push.delete","POST",{id:e})},r=function(e){return Object(o["a"])("/admin/api.app.push.info","POST",{id:e})},l=function(e){return Object(o["a"])("/admin/api.app.push.save","POST",e)},s=function(e){return Object(o["b"])("/admin/api.app.push.down.template","POST",{})}},b9e9:function(e,t,n){n("7445"),e.exports=n("584a").parseInt},e646:function(e,t,n){},e814:function(e,t,n){e.exports=n("b9e9")}}]);
//# sourceMappingURL=chunk-a59c6f14-legacy.71f75947.js.map