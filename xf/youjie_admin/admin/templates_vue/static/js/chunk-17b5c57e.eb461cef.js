(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-17b5c57e"],{"097d":function(e,t,i){"use strict";var s=i("5ca1"),r=i("8378"),a=i("7726"),n=i("ebd6"),l=i("bcaa");s(s.P+s.R,"Promise",{finally:function(e){var t=n(this,r.Promise||a.Promise),i="function"==typeof e;return this.then(i?function(i){return l(t,e()).then(function(){return i})}:e,i?function(i){return l(t,e()).then(function(){throw i})}:e)}})},2801:function(e,t,i){"use strict";i.d(t,"d",function(){return r}),i.d(t,"b",function(){return a}),i.d(t,"f",function(){return n}),i.d(t,"c",function(){return l}),i.d(t,"a",function(){return o}),i.d(t,"e",function(){return c}),i.d(t,"g",function(){return d});var s=i("65c6");const r=()=>Object(s["c"])("/admin/api.shippingtpl.list","POST",{}),a=e=>Object(s["c"])("/admin/api.shippingtpl.delete","POST",{id:e}),n=e=>Object(s["c"])("/admin/api.shippingtpl.save","POST",{name:e.name,id:e.tplID,tpl_type:e.tpl_type}),l=e=>Object(s["c"])("/admin/api.shippingtplarea.list","POST",{tpl_id:e}),o=e=>Object(s["c"])("/admin/api.shippingtplarea.delete","POST",{id:e}),c=e=>Object(s["c"])("/admin/api.shippingtplarea.save","POST",{item:e}),d=(e,t)=>Object(s["c"])("/admin/api.shippingtplarea.get","POST",{id:e||"0",tpl_id:t})},"473f":function(e,t,i){"use strict";i.r(t);var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"container"},[i("page-title",{attrs:{"first-title":"添加运费模板"}}),i("div",{staticClass:"shipping-name-wrapper"},[i("span",[e._v("*")]),i("label",[e._v("模板名称：")]),i("el-input",{attrs:{placeholder:"请自定义模板名称"},model:{value:e.shippingName,callback:function(t){e.shippingName=t},expression:"shippingName"}})],1),i("div",{staticClass:"shipping-name-wrapper"},[i("span",[e._v("*")]),i("label",[e._v("模板类型：")]),i("el-select",{attrs:{disabled:!!e.tplID},model:{value:e.shippingType,callback:function(t){e.shippingType=t},expression:"shippingType"}},[i("el-option",{attrs:{label:"常规模板",value:1}}),i("el-option",{attrs:{label:"指定条件包邮",value:2}})],1)],1),e.tplID?i("div",{staticClass:"delivery-area-wrapper"},[i("p",[e._v("配送区域")]),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.deliveryAreaList,border:"",stripe:""}},[i("el-table-column",{attrs:{prop:"area_list_name",label:"地区"}}),i("el-table-column",{attrs:{label:"操作",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-button",{attrs:{type:"text",size:"small"},on:{click:function(i){return e.editArea(t.row.id)}}},[e._v("编辑")]),i("el-button",{attrs:{type:"text",size:"small"},on:{click:function(i){return e.deleteArea(t.row.id)}}},[e._v("删除")])]}}],null,!1,1320985650)}),i("el-table-column",{attrs:{label:"首件数",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("input",{directives:[{name:"model",rawName:"v-model",value:t.row.head,expression:"scope.row.head"}],attrs:{type:"text"},domProps:{value:t.row.head},on:{input:function(i){i.target.composing||e.$set(t.row,"head",i.target.value)}}})]}}],null,!1,3705233867)}),i("el-table-column",{attrs:{label:"运费",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("input",{directives:[{name:"model",rawName:"v-model",value:t.row.head_fee,expression:"scope.row.head_fee"}],attrs:{type:"text"},domProps:{value:t.row.head_fee},on:{input:function(i){i.target.composing||e.$set(t.row,"head_fee",i.target.value)}}})]}}],null,!1,886460459)}),1==e.shippingType?[i("el-table-column",{attrs:{label:"续件",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("input",{directives:[{name:"model",rawName:"v-model",value:t.row.step,expression:"scope.row.step"}],attrs:{type:"text"},domProps:{value:t.row.step},on:{input:function(i){i.target.composing||e.$set(t.row,"step",i.target.value)}}})]}}],null,!1,1340224843)}),i("el-table-column",{attrs:{label:"续费",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("input",{directives:[{name:"model",rawName:"v-model",value:t.row.step_fee,expression:"scope.row.step_fee"}],attrs:{type:"text"},domProps:{value:t.row.step_fee},on:{input:function(i){i.target.composing||e.$set(t.row,"step_fee",i.target.value)}}})]}}],null,!1,3858278571)})]:e._e(),2==e.shippingType?[i("el-table-column",{attrs:{label:"包邮条件",width:"600"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("div",{staticClass:"free-wrapper"},[i("el-select",{attrs:{placeholder:"请选择包邮条件类型",size:"small"},model:{value:t.row.free_type,callback:function(i){e.$set(t.row,"free_type",i)},expression:"scope.row.free_type"}},[i("el-option",{attrs:{label:"请选择包邮条件类型",value:0,disabled:""}}),i("el-option",{attrs:{label:"满件",value:1}}),i("el-option",{attrs:{label:"满元",value:2}}),i("el-option",{attrs:{label:"满件或满元",value:3}})],1),i("div",{staticClass:"free-rule"},[e._v("\n                满\n                "),1==t.row.free_type||3==t.row.free_type?[i("input",{directives:[{name:"model",rawName:"v-model",value:t.row.free_sum,expression:"scope.row.free_sum"}],staticClass:"text",attrs:{type:"text"},domProps:{value:t.row.free_sum},on:{input:function(i){i.target.composing||e.$set(t.row,"free_sum",i.target.value)}}}),e._v("\n                  件\n                ")]:e._e(),e._v("\n                "+e._s(3==t.row.free_type?"，":"")+"\n                "),2==t.row.free_type||3==t.row.free_type?[i("input",{directives:[{name:"model",rawName:"v-model",value:t.row.free_fee,expression:"scope.row.free_fee"}],attrs:{type:"text"},domProps:{value:t.row.free_fee},on:{input:function(i){i.target.composing||e.$set(t.row,"free_fee",i.target.value)}}}),e._v("\n                  元\n                ")]:e._e(),e._v("\n                以上包邮\n              ")],2)],1)]}}],null,!1,478092218)})]:e._e()],2)],1):e._e(),e.isSaveTpl?i("div",{staticClass:"add-area-wrapper"},[i("el-button",{attrs:{type:"text"},on:{click:e.addNewAddr}},[e._v("指定地区与运费")])],1):e._e(),i("div",{staticClass:"btn-group-wrapper"},[i("el-button",{attrs:{type:"primary"},on:{click:e.saveArea}},[e._v("保存")]),i("el-button",{staticClass:"btn-back",on:{click:e.goBack}},[e._v("返回")])],1),i("div",{staticClass:"area_dialog"},[i("el-dialog",{attrs:{visible:e.dialogVisible,width:"60%","show-close":!1},on:{"update:visible":function(t){e.dialogVisible=t},open:e.getAddress,closed:function(t){e.isShowRegionsList=!1}}},[i("div",{attrs:{slot:"title"},slot:"title"},[e._v("自定义地区邮费")]),i("div",{staticClass:"check-all"},[i("el-checkbox",{attrs:{indeterminate:e.isIndeterminate},on:{change:e.handleCheckAllChange},model:{value:e.isCheckAll,callback:function(t){e.isCheckAll=t},expression:"isCheckAll"}},[e._v("全选")])],1),i("div",{directives:[{name:"loading",rawName:"v-loading",value:e.isRegionsLoading,expression:"isRegionsLoading"}],staticClass:"total-address-wrapper"},[e.isShowRegionsList?i("el-cascader-panel",{ref:"cascaderPanel",attrs:{props:e.props,options:e.provinceList},on:{change:e.checkCities},model:{value:e.checkedAddress,callback:function(t){e.checkedAddress=t},expression:"checkedAddress"}}):e._e()],1),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary"},on:{click:e.confirmAddress}},[e._v("确 定")]),i("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")])],1)])],1)],1)},r=[],a=(i("ac6a"),i("097d"),i("2801"));var n={name:"SuppliersShippingTemplatesAdd",data(){return{props:{multiple:!0,value:"region_id",label:"region_name",children:"list",emitPath:!1},shippingName:"",shippingType:void 0,freeType:void 0,deliveryAreaList:[],dialogVisible:!1,areaID:"",tplID:"",provinceList:[],checkedAddress:[],loading:!0,isRegionsLoading:!1,isShowRegionsList:!1,citiesCount:0,isIndeterminate:!1,isCheckAll:!1,selectAllProvince:[],selectAllArea:[]}},created(){this.tplID=this.$route.query.tplID;let e=this.$route.query;e.tplID&&(this.shippingName=e.tplName,this.shippingType=Number(e.type),this.getAreaList(e.tplID))},computed:{isSaveTpl(){return!!this.tplID}},methods:{getAddress(){this.checkedAddress=[],this.provinceList=[],this.selectAllArea=[],this.citiesCount=0,this.isIndeterminate=!1,this.isCheckAll=!1,this.isRegionsLoading=!0,this.isShowRegionsList=!0,Object(a["g"])(this.areaID,this.tplID).then(e=>{this.provinceList=e.area_list_msg,this.provinceList.map(t=>{t.list&&0!=t.list.length||(t.list=[{region_id:t.region_id,region_name:t.region_name}],t.checked&&(t.list=[{region_id:t.region_id,region_name:t.region_name,checked:t.checked}])),t.list.map(t=>{t.list&&0!=t.list.length||(t.list=[{region_id:t.region_id,region_name:t.region_name}],t.checked&&(t.list=[{region_id:t.region_id,region_name:t.region_name,checked:t.checked}])),this.citiesCount+=t.list.length,t.list.forEach(e=>{this.selectAllArea.push(e.region_id)}),this.areaID&&t.list.map(t=>{e.area_list&&1===e.area_list.length&&"1"==e.area_list[0]&&(t.checked=1),t.checked&&this.checkedAddress.push(t.region_id)})})}),this.checkCities()}).finally(()=>{this.isRegionsLoading=!1})},getAreaList(e){Object(a["c"])(e).then(e=>{this.deliveryAreaList=e,this.loading=!1})},editArea(e){this.areaID=e,this.dialogVisible=!0},deleteArea(e){Object(a["a"])(e).then(t=>{let i=this.deliveryAreaList,s=this.deliveryAreaList.length;for(let r=0;r<s;r++)if(i[r].id===e){i.splice(r,1),this.$notify.success("删除成功");break}})},goBack(){this.$router.go(-1)},saveArea(){let e=this.shippingName;if(!e)return void this.$notify.error("模板名称必填");if(!this.shippingType||0==this.shippingType)return void this.$notify.error("模板类型必选");let t=this;for(let a=0;a<this.deliveryAreaList.length;a++){let e=this.deliveryAreaList[a];if(e.head%1!==0||e.head<=0)return void t.$notify.error("第".concat(a+1,"条数据中，首件必须为大于0的整数"));if(e.step%1!==0)return void t.$notify.error("第".concat(a+1,"条数据中，续件必须为整数"));if(isNaN(e.head_fee)||isNaN(e.step_fee)||e.head_fee<0||e.step_fee<0)return void t.$notify.error("第".concat(a+1,"条数据中，费用必须为数字且大于等于0"));if(2==this.shippingType&&0==e.free_type)return void t.$notify.error("第".concat(a+1,"条数据中，必须选择包邮条件类型"));if(e.free_type>0){if([1,3].indexOf(e.free_type)>-1&&(e.free_sum%1!==0||e.free_sum<=0))return void t.$notify.error("第".concat(a+1,"条数据中，满件必须为大于0的整数"));if([2,3].indexOf(e.free_type)>-1&&(isNaN(e.free_fee)||e.free_fee<=0))return void t.$notify.error("第".concat(a+1,"条数据中，满元必须为大于0的数字"))}}const i=function(){return new Promise((i,s)=>{Object(a["f"])({name:e,tplID:t.tplID,tpl_type:t.shippingType}).then(e=>{i(e)},e=>{s(e)})})},s=function(){return new Promise((e,i)=>{t.deliveryAreaList.forEach(e=>{e.area_list=JSON.stringify(e.area_list)}),Object(a["e"])(t.deliveryAreaList).then(t=>{e(t)},e=>{i(e)})})},r=[];r.push(i()),this.deliveryAreaList.length>0&&r.push(s()),Promise.all(r).then(e=>{this.loading=!1,this.$notify.success("保存成功"),this.tplID?this.goBack():e[0].tpl_id&&(this.tplID=e[0].tpl_id)})},confirmAddress(){if(0==this.checkedAddress.length)return void this.$msgbox({message:"请选择配送地区",type:"error"});this.dialogVisible=!1,this.loading=!0;let e=this,t=[];if(t=[...this.checkedAddress],this.areaID)this.deliveryAreaList.forEach(i=>{i.area_list=JSON.stringify(i.area_list),i.id===e.areaID&&(i.area_list=JSON.stringify(t))}),Object(a["e"])(this.deliveryAreaList).then(()=>{this.getAreaList(this.tplID)});else{let e=[{area_list:JSON.stringify(t),head:1,head_fee:0,step:0,step_fee:0,tpl_id:this.tplID,free_type:0,free_sum:0,free_fee:0}];Object(a["e"])(e).then(()=>{this.getAreaList(this.tplID)})}},addNewAddr(){this.areaID="",this.dialogVisible=!0},checkCities(){const e=this.checkedAddress.length;this.isCheckAll=this.citiesCount==e,this.isIndeterminate=e>0&&e<this.citiesCount},handleCheckAllChange(e){e?(this.checkedAddress=this.selectAllArea,this.isIndeterminate=!1):this.$refs.cascaderPanel.clearCheckedNodes()}}},l=n,o=(i("e409"),i("6f8e"),i("2877")),c=Object(o["a"])(l,s,r,!1,null,"a9315b84",null);t["default"]=c.exports},6109:function(e,t,i){},"6f8e":function(e,t,i){"use strict";var s=i("6109"),r=i.n(s);r.a},"797d":function(e,t,i){},a5b8:function(e,t,i){"use strict";var s=i("d8e8");function r(e){var t,i;this.promise=new e(function(e,s){if(void 0!==t||void 0!==i)throw TypeError("Bad Promise constructor");t=e,i=s}),this.resolve=s(t),this.reject=s(i)}e.exports.f=function(e){return new r(e)}},bcaa:function(e,t,i){var s=i("cb7c"),r=i("d3f4"),a=i("a5b8");e.exports=function(e,t){if(s(e),r(t)&&t.constructor===e)return t;var i=a.f(e),n=i.resolve;return n(t),i.promise}},e409:function(e,t,i){"use strict";var s=i("797d"),r=i.n(s);r.a}}]);
//# sourceMappingURL=chunk-17b5c57e.eb461cef.js.map