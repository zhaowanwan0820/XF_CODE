{include file="web/views/header.html"}
<link rel="stylesheet" type="text/css" href="<?php echo $this->asset->makeUrl('v3/css/jiathis_share.css');?>" />
<link rel="stylesheet" type="text/css" href="<?php echo $this->asset->makeUrl('v3/css/share.v1.css');?>" />
<link href="<?php echo $this->asset->makeUrl('v3/css/activity/newUserPage.css');?>" type="text/css" rel="stylesheet">
<script src="<?php echo $this->asset->makeUrl('v3/js/common/jquery-1.10.2.min.js');?>" type="text/javascript"></script>
<script src="<?php echo $this->asset->makeUrl('v3/js/vendor/ZeroClipboard.min.js');?>"></script>
<script src="<?php echo $this->asset->makeUrl('v3/js/widget/share/share.v1.js');?>"></script>
<script src="<?php echo $this->asset->makeUrl('v3/js/widget/qrcode/qrcode.v1.min.js');?>"></script>
<script src="<?php echo $this->asset->makeUrl('v3/js/activity/newUserPage.js?v=11');?>" type="text/javascript"></script>
<style>
    .layAppTopnew .isNewUser_11626, .layAppTopnew .app{ display:none; }
    .new_platform_2 .knowMore{padding-bottom: 30px;}
    .img_wangxin{padding:0;}
   .p_new_user_page .new_deal .have_deal .scroll_center .bg_linear_top {
        background-image: -webkit-linear-gradient(top, transparent 50%, rgba(255, 238, 177, 0) 100%);
        background-image: linear-gradient(180deg, transparent 50%, rgba(255, 238, 177, 0) 100%);
        top: 0px;
    }
    .p_new_user_page .new_deal .have_deal .scroll_center .bg_linear_bottom {
        background-image: -webkit-linear-gradient(bottom, transparent, rgba(255, 238, 177, 0));
        background-image: linear-gradient(0deg, transparent, rgba(255, 238, 177, 0));
        bottom: 0px;
    }
    .p_new_user_page .bannerBox {
        background: url('//event.ncfwx.com/upload/image/20180228/10-36-2_0227_02.jpg') no-repeat center top;
        position: relative;
        height:434px;
    }
    .p_new_user_page ._bannerBox {
        background: url('//event.ncfwx.com/upload/image/20180228/14-24-WechatIMG917.jpeg') no-repeat center top;
        position: relative;
        height:434px;
    }
    .p_new_user_page .new_platform_2{background-color: #676767!important;}
    .p_new_user_page .new_register{background-color:#fcfcfc!important;}
    .p_new_user_page .new_platform{background-color:#fff!important;}
    .p_new_user_page .statementBox{text-align:center; background-color:#e4a318; width:100%;}
    .p_new_user_page .img_wangxin{width:1100px;}
    .p_new_user_page .new_deal{background-color:#ffbf36; position:relative;}
    .p_new_user_page .statementBox, .statementUl li{color:#fff;}
    .p_new_user_page .new_deal .have_deal .count_deal{color:#8f6100; font-weight:bold;}
    .p_new_user_page .new_deal .have_deal .scroll_center .scroll_list .scroll_list_ul li{color:#8f6100;}
    .p_new_user_page .have_deal{border-bottom:none;}
    .p_new_user_page .red{color:#ea6039!important;}
    .p_new_user_page .four_img{padding: 0 0;}
    .p_new_user_page .statementUl li{margin-top:3px;}
    .p_new_user_page .statementUl li:first-child{margin-top:5px;}
    .p_new_user_page .statementUl{padding-bottom:40px;}
    .p_new_user_page .new_platform_3{padding-bottom:50px; position:relative;}
    .p_new_user_page .reg_btn{position:absolute; left:413px; bottom:20px;}
    .p_new_user_page .iframe_register{top:-19px;}
    .p_new_user_page .bannerBox{height:434px;}
    .p_new_user_page .kep_2{height:106px; text-align:center; line-height:106px; font-size:26px; font-weight:bold; color:#8f6100;}
    .p_new_user_page .bannerBox a{width:1100px; height:434px; margin:0 auto; display:block;}

</style>
<style>
        .normal-card {
            display: inline-block;
            vertical-align: top;
            width: 320px;
            height: 367px;
            text-align: center;
            background-color: #fff;
            border-radius: 10px;
            margin: 18px 27px 21px;
        }
        .normal-card .head {
            display: block;
            line-height: 70px;
            text-align: center;
            font-size: 24px;
            color: #111;
            border-bottom: 1px solid #f0f0f0;
        }
        .content {
            padding: 20px 0;
        }
        .normal-card .info-top {
            line-height: 32px;
            color: #999;
            font-size: 14px;
        }
        .normal-card .info-middle {
            line-height: 50px;
            margin-bottom: 2px;
            font-size: 42px;
            font-weight: normal;
            color: #ea5c3a;
        }
        .normal-card .info-bottom {
            font-size: 14px;
            color: #888;
            line-height: 68px;
            height: 80px;
        }
        .normal-card .info-bottom-high {
            font-size: 30px;
            font-wieght: bold;
            color: #ea5c3a;
        }
        .normal-card .info-bottom-high-text {
            font-size: 18px;
            font-wieght: bold;
            color: #ea5c3a;
        }
        .normal-card .btn {
            display: inline-block;
            vertical-align: top;
            width: 276px;
            height: 40px;
            margin-bottom: 3px;
            line-height: 40px;
            border-radius: 5px;
            font-weight: bold;
            color: #fff;
            font-size: 16px;
            background-color: #ea5c3a;
        }
        .normal-card .tips {
            font-size: 12px;
            line-height: 42px;
            color: #333;
        }
        .normal-card .tips-high {
            color: #ff5737;
        }

        .primary-card {
            display: inline-block;
            vertical-align: top;
            width: 352px;
            height: 399px;
            text-align: center;
            background: url(//event.ncfwx.com/upload/image/20180119/03-03-_20180119030322.png) no-repeat center center;
            border-radius: 10px;
            color: #fff;
            margin: 0 27px;
        }
        .primary-card .head {
            display: block;
            line-height: 77px;
            height: 77px;
            font-size: 26px;
            color: #fff;
            border-bottom: 1px solid rgba(240, 240, 240, .7);
        }
        .primary-card .info-top {
            line-height: 40px;
            color: #fff;
            font-size: 16px;
        }
        .primary-card .info-middle {
            line-height: 48px;
            font-size: 46px;
            color: #fff;
        }
        .primary-card .info-bottom {
            font-size: 16px;
            color: #fff;
            line-height: 88px;
            height: 95px;
        }
        .primary-card .info-bottom-high {
            font-size: 33px;
            font-wieght: bold;
            color: #fff;
        }
        .primary-card .info-bottom-high-text {
            font-size: 20px;
            font-wieght: bold;
        }
        .primary-card .btn {
            display: inline-block;
            vertical-align: top;
            width: 304px;
            height: 43px;
            margin-bottom: 3px;
            line-height: 43px;
            border-radius: 5px;
            font-weight: bold;
            color: #ea5c3a;
            font-size: 18px;
            background-color: #fff;
        }
        .primary-card .tips {
            font-size: 13px;
            line-height: 52px;
            color: #fff;
        }
        .primary-card .tips-high {
            color: #fff;
        }
        .card-wrapper {
            text-align: center;
        }
        .primary-card .percent {
            font-size: 33px;
            color: #fff;
            font-weight: normal;
        }
        .normal-card .percent {
            font-size: 24px;
            color: #ea5c3a;
            font-weight: normal;
        }
        .p_new_user_page .mask_container{display:none; position:fixed; z-index:10; top:50%; left:50%; margin: -232px 0 0 -425px;}
        .p_new_user_page .mask_content{margin: 0 auto; width: 850px; text-align: center;z-index:100; position: relative;}
        .p_new_user_page .back_btn{position:absolute; right:-27px; top:-25px; z-index:10000}
        .p_new_user_page .img_box{background-image: url(//event.ncfwx.com/upload/image/20180123/11-39-mask_img.png); width:850px; height:464px; background-repeat:no-repeat;}
        .iframe_register {position: absolute; top: -26px; left: -266px; width: 135%; height: 104%;}
        .p_new_user_page .mask{position:fixed; z-index:100; width:100%; height:100%; background-color:#000; top:0; left:0; opacity:0.6; filter:alpha(opacity=60);}
</style>

<div class="p_new_user_page main">
    <div class="mask_container">
        <div class="mask"></div>
        <div class="mask_content">
            <div class="img_box">
              <img src="//event.ncfwx.com/upload/image/20180123/22-06-huaban-(3)_03.png" class="JS_back back_btn"/>
              <iframe src="/user/register?modal=1"  scrolling="no" frameborder=" " width="100%" height="100%" class="iframe_register" id="ifm" name="ifm" allowTransparency="true"></iframe>
            </div>
        </div>
    </div>
    <input type="hidden" value="{$userStatus.isRegister}" id="isRegister" />
    <input type="hidden" value="{$userStatus.isInvest}" id="isInvest" />
    <input type="hidden" value="{$userStatus.isInvite}" id="isInvite" />
    <!-- banner图-->
    <div class="{if !$user_info}bannerBox{else}_bannerBox{/if}" id="bannerBox">
        {if !$user_info}
        <a href="javascript:void(0)" class="JS_mask"></a>
        {/if}
    </div>

    <!-- 去注册-->
    <div class="new_register">
        <div class="new_welfare" style="background: #fff1ce;">
            <div class="welfare_detail" style="width: 1100px;margin: 0 auto;">
                <img src="//event.ncfwx.com/upload/image/20180209/16-14-_20180209161338.jpg" alt="" style="display:block;width:100%;"/>
                <img src="//event.ncfwx.com/upload/image/20180228/14-20-WechatIMG899.jpeg" alt="" style="display:block;margin:0 auto;cursor: pointer;" class="JS_mask_two"/>
                <img src="//event.ncfwx.com/upload/image/20180228/10-46-WechatIMG848.jpeg" alt="" style="display:block;width:100%;">
            </div>
            <div style="background:#ff672b;">
                <div style="width:1100px;margin:0 auto;">
                    <img src="//event.ncfwx.com/upload/image/20180228/10-48-WechatIMG849.jpeg" alt="" style="display:block;width:100%;"/>
                </div>
            </div>
        </div>
    </div>

    <!-- 投资赚钱 begin -->
    <div class="new_deal">
        <div class="kep_2">新手专享标的</div>
        <div class="card-wrapper" id="card_wrapper">
            <!-- <div class="normal-card">
                <div class="head">
                    智多新30天
                </div>
                <div class="content">
                    <div class="info">
                    <div class="info-top">
                        预期年化
                    </div>
                    <div class="info-middle">
                        50.30
                    </div>
                    <div class="info-bottom">
                        投资期限
                        <span class="info-bottom-high">30</span>
                        <span class="info-bottom-high-text">天可转让</span>
                    </div>
                    </div>
                    <a class="btn">
                    立即投资
                    </a>
                    <div class="tips">
                        新用户：投100元 - <span class="tips-high">返10元</span>，投10000元 - 返66元
                    </div>
                </div>
            </div> -->
        </div>
        <div class="xs_content">
            <div class="contentBox new_platform_3">
                <div class="list_cont">

                </div>
                <div class="have_deal">
                    <div class="count_deal">今日已有
                        <span class="red">{$loadUserCount}</span>位用户投资</div>
                    <div class="scroll_center">
                        <div class="bg_linear_top"></div>
                        <div class="bg_linear_bottom"></div>
                        <div class="scroll_list">
                            <ul class="scroll_list_ul" id="scrollListUl" data-list='{$loadList}'>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="reg_btn JS_btn"><a href="#ifm" id="JS_link"><img src="//event.ncfwx.com/upload/image/20180228/11-01-WechatIMG850.jpeg"></a></div>
            </div>
        </div>
    </div>
    <div class="statementBox" style="display:none;">
        <div class="title">特别申明</div>
        <ul class="statementUl">
            <li>投资券、红包有效期均为30天，自收到时开始计算；</li>
            <li>投资券仅适用于投资P2P、专享、智多新产品，不适用于投资"新手专区"项目或通过"随心约"投资；</li>
        </ul>
    </div>

    <!-- 平台介绍 begin -->
    <div class="new_platform contentBox">
        <div class="xs_content img_wangxin"><img src="//event.ncfwx.com/upload/image/20180118/23-34-liebao_07.jpg" class="four_img"/></div>
    </div>
    <!-- 平台介绍002 begin -->
    <div class="new_platform_2 contentBox">
        <div class="xs_content img_2">
            <img src="//event.ncfwx.com/upload/image/20180119/01-41-55555555_07.jpg"/>
        </div>
    </div>

    <!-- footer -->
    <div class="foot">
        <img src="<?php echo $this->asset->makeUrl('v3/images/activity/new_user_page/logo.png');?>" alt="" class="logo">
        <div class="foot_content">
            <p>北京经讯时代科技有限公司 客服电话：400-890-9888</p>
            <p>公司总部：北京市朝阳区霄云路28号网信大厦A座</p>
            <p>市场有风险 投资需谨慎</p>
        </div>
    </div>

    <script id="scrollUl_tpl" type="text/html">
        <% var item=null; %>
        <% for( var i=0,max=arr.length;i<max;i++){ %>
        <% item=arr[i]; %>
            <li>用户<%= item.mobile %> 刚刚投资了<%= item.money %>元</li>
        <% } %>
        <% for( var i=0;i<4;i++){ %>
        <% item=arr[i]; %>
        <li>用户<%= item.mobile %> 刚刚投资了<%= item.money %>元</li>
        <% } %>
    </script>
    <script id="activity_card" type="text/html">
        <% for(var i=0; i<list.length; i++){ %>
        <% var item = list[i] %>
        <div class="<%= list[i].className %>">
            <% if(USER_INFO == 1){ %>
                <% if (item.lock_day) { %>
                    <a class="head" href="/finplan/bid/<%= item.id %>"><%= item.name %></a>
                <% } else { %>
                    <a class="head" href="<%= item.url %>"><%= item.name %></a>
                <% } %>
            <% }else{ %>
                <a href="javascript:void(0)" class="head JS_no_login"><%= item.name %></a>
            <% } %>
            <div class="content">
                <div class="info">
                    <% if (item.lock_day) { %>
                        <div class="info-top">往期年化</div>
                    <% } else { %>
                        <div class="info-top">预期年化</div>
                    <% } %>
                <div class="info-middle">
                    <% if (item.lock_day) { %>
                        <%= item.min_rate %><span class="percent">%~</span><%= item.max_rate %><span class="percent">%</span>
                    <% } else { %>
                        <%= item.income_base_rate %><span class="percent">%</span>
                    <% } %>
                </div>
                <div class="info-bottom">
                    <% if (item.lock_day) { %>
                        <span class="info-bottom-high"><%= item.lock_day %></span>
                        <span class="info-bottom-high-text">天可申请转让/退出</span>
                    <% } else { %>
                        投资期限<span class="info-bottom-high"><%= item.repay_time %></span>
                        <span class="info-bottom-high-text">个月</span>
                    <% } %>
                </div>
                </div>
                <% if(USER_INFO == 1){ %>
                    <% if (item.lock_day) { %>
                        <a class="btn" href="/finplan/bid/<%= item.id %>">立即加入</a>
                    <% } else { %>
                        <a class="btn" href="<%= item.url %>">立即投资</a>
                    <% } %>
                <% }else{ %>
                    <% if (item.lock_day) { %>
                        <a href="javascript:void(0);" class="btn JS_no_login">立即加入</a>
                    <% } else { %>
                        <a href="javascript:void(0);" class="btn JS_no_login">立即投资</a>
                    <% } %>
                <% } %>
            </div>
        </div>
        <% } %>
    </script>
    <script>
        $(".JS_mask").click(function() {
            $(".mask_container").show();
        });
        $('#JS_link').click(function() {
            $(".mask_container").show();
        });
        $(".JS_back").click(function() {
            $(".mask_container").hide();
        });
        $("body").on('click','.new_deal .JS_no_login',function(){
            $(".mask_container").show();
        })

        Array.prototype.filter = Array.prototype.filter || function (func){
            var rs = []
            for(var i = 0;i < this.length; i++){
              if(func(this[i])){
                rs.push(this[i])
              }
            }
            return rs
        }

        Array.prototype.findIndex = Array.prototype.findIndex || function(func){
            for(var i=0;i<this.length;i++){
                if (func(this[i])) {
                  return i
                }
            }
            return -1
        }

        Array.prototype.indexOf = Array.prototype.indexOf || function (element){
            for(var i=0;i<this.length;i++){
                if (element == this[i]) {
                  return i
                }
            }
            return -1
        }
        function getRequiredList(list,p2pDeals,zxDeals) {
            var requiredIds = ['2', '3', '5'] // id为2的时候为30天智多新
            var actualList = list.filter(function (item) { return requiredIds.indexOf(item.id) > -1 })
            var actualLength = actualList.length

            if(actualLength === 3) { // 如果获取了目标内的三个标, 那么id为2的智多新在中间
                var middleId = actualList.findIndex(function (item) { return item.id === '2' })
                var middleItem = actualList.splice(middleId, 1)
                actualList.splice(1, 0, middleItem[0])
            }

            //最左侧6个月的p2p>6个月的专享，右侧12个月的专享>12个月的p2p，p2p专享都没有则显示智多新
            var sixMonthP2p = isHaveItem("6",p2pDeals),
                sixMonthZx = isHaveItem("6",zxDeals),
                twelveMonthP2p = isHaveItem("12",p2pDeals),
                twelveMonthZx = isHaveItem("12",zxDeals);
            var sixMonthP2pList = {income_base_rate:"9.00",name:"p2p6个月",repay_time:"6",url:"/deals?tab=p2p"},
                sixMonthZxList = {income_base_rate:"8.50",name:"专享6个月",repay_time:"6",url:"/deals?tab=zx"},
                twelveMonthP2pList = {income_base_rate:"10.00",name:"p2p12个月",repay_time:"12",url:"/deals?tab=p2p"},
                twelveMonthZxList = {income_base_rate:"9.30",name:"专享12个月",repay_time:"12",url:"/deals?tab=zx"};
            //左侧
            if(sixMonthP2p){//有6个月p2p
                actualList.splice(0,1,sixMonthP2pList)
            }else if(sixMonthZx){//有6个月专享
                actualList.splice(0,1,sixMonthZxList)
            }
            //右侧
            if(twelveMonthZx){//12个月专享
                actualList.splice(2,1,twelveMonthZxList)
            }else if(twelveMonthP2p){//12个月p2p
                actualList.splice(2,1,twelveMonthP2pList)
            }
            return actualList
        }
        function isHaveItem(month,list){
            var monthList = list.filter(function(item){
                return item.repay_time == month && item.loantype != 5
            })
            if(monthList.length > 0){
                return true;
            }else{
                return false;
            }
        }
        function renderList(list) {
            if (list.length === 3) {
                list[0].className = 'normal-card'
                list[1].className = 'primary-card'
                list[2].className = 'normal-card'
            } else if (list.length === 2) {
                list[0].className = 'normal-card'
                list[1].className = 'normal-card'
            } else if (list.length === 1) {
                list[0].className = 'primary-card'
            }

            var html = template('activity_card', {list: list,USER_INFO: USER_INFO})
            document.getElementById('card_wrapper').innerHTML = html
        }

        $.ajax({
            url: '/activity/deals',
            success: function (data) {
                var parseDatas = JSON.parse(data),
                    duotouDeals = parseDatas.data.duotou || [],
                    p2pDeals = parseDatas.data.p2p || [],
                    zxDeals = parseDatas.data.zx || [];
                var requiredList = getRequiredList(duotouDeals,p2pDeals,zxDeals)
                renderList(requiredList)
            },
            error: function (err) {
                console.error(err)
            }
        })
    </script>
    <script type='text/javascript'>
    //百度统计
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?99c51ca2f40d8b431183dd922ed9d09c";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
    var _ncf={"prd":"firstp2p","pstr":"","pfunc":null,"pcon":"&uf=pc","pck":{"channel":"channel","fpid":"fpid"},"trid":"","channel":['pubid','mediumid','adid','adsize'],"rfuniq":[],"rfmuti":[]};
    (function(p,h,s){var o=document.createElement(h);o.src=s;p.appendChild(o)})(document.getElementsByTagName("HEAD")[0],"script","<?php echo $this->asset->makeUrl('default/js/ncfpb.1.5.min.js');?>");
    </script>
    <script>
        if(USER_INFO == 1){
            // $("#JS_link").attr("href","https://liebao.ncfwx.com/user/register")
            $(".JS_btn").hide();
            $(".JS_mask_two").attr('src','//event.ncfwx.com/upload/image/20180228/15-20-WechatIMG954.jpeg')
        }else{
            $(".JS_mask_two").click(function(){
                $(".mask_container").show();
            })
        }
        var registerWin = $('#ifm')[0].contentWindow.window;
        registerWin.onload = function () {
          registerWin.$('head').append('<style>.ui-form .er-icon span{color: #fff;}.ui-form .form-sprite {background-image: url(//event.ncfwx.com/upload/image/20180123/22-00-form_sprite.png);background-repeat: no-repeat;} </style>');
           registerWin.$('.reg-mid').css({background: "transparent"});
           registerWin.$('.btn-sub').css({background: "#fdef3f", borderRadius: "3px", color: "#de352d",left: "-169px", width: "282px"});
           registerWin.$('.blue').css({ color: "#fdef3f"});
           registerWin.$('.color-mid').css({ color: "#fff"});
           registerWin.$('.reg_tips_red').css({ backgroundColor: "#ed6350", color: "#fff"});
           registerWin.$('.reg_tips_red').css({ backgroundColor: "#ed6350", color: "#fff"});
           registerWin.$('.ml70').css({color: "#fff"});
           registerWin.$('.ui-form .error-wrap').css({color: "#ffc0bc", background: "transparent"});
           registerWin.$('.er-icon span').css({color: "#ffc0bc"});
           registerWin.$('.ui-form .er-icon span').css({color: "#ffc0bc"});
        }
    </script>

