<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="description" content="">
        <meta name="keywords" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
        <!--public js&css start-->
        <link href="<?php echo $this->asset->makeUrl('v1/css/oauth/mobile/m-base.css');?>" rel="stylesheet" type="text/css" />
        <link href="<?php echo $this->asset->makeUrl('v1/css/oauth/mobile/m-common.css');?>" rel="stylesheet" type="text/css" />
        <script type="text/javascript" src="<?php echo $this->asset->makeUrl('v1/js/risk/frms-fingerprint-min.js');?>"></script>
        <script src="<?php echo $this->asset->makeUrl('v1/js/oauth/mobile/zepto.js');?>"></script>
        <!--public js&css end-->
        <!--private js&css start-->
        <script src="<?php echo $this->asset->makeUrl('v1/js/oauth/mobile/common.js');?>"></script>
        <link href="<?php echo $this->asset->makeUrl('v1/css/oauth//mobile/p-user-register.css');?>" rel="stylesheet" type="text/css" />
        <script type="text/javascript" src="<?php echo $this->asset->makeUrl('v2/js/event/iscroll.js');?>"></script>
        <!--private js&css end-->

        <title>账号注册</title>
        <style class="JS-old_style">
            html { font-size: 62.5%; -webkit-text-size-adjust: 100%; -ms-text-size-adjust: 100%; }
            body { width: 100%;background-color: #f5f5f9; font-family: "微软雅黑","Microsoft YaHei"; color: #343434; font-size: 12px;overflow-y: auto !important; }
            *:focus, *:active { outline: none !important; }
            * { margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; outline-style: none; }
            img { border: 0px; }
            ul, li { list-style-type: none; }
            a { text-decoration: none; font-family: "微软雅黑","Microsoft YaHei"; }
                a:hover { text-decoration: none; }
                /*a:active, a:visited { color: #666; }*/
            .fontHY { font-family: "微软雅黑","Microsoft YaHei"; }
            .colorRed { color: #000;}
            .bgf5 { background-color: #f5f5f5; }
            /*新加的样式*/
            .icon_msg, .icon_edit, .icon_lock, .icon_red_ok { width: 33px; height: 33px; display: inline-block; margin-top: 15px; vertical-align: middle; }
            .icon_msg { background: url("<?php echo $this->asset->makeUrl('v1/images/oauth/mobile/haha/icon.png');?>") left -34px no-repeat; background-size: 33px auto; }
            .icon_edit { background: url("<?php echo $this->asset->makeUrl('v1/images/oauth/mobile/haha/icon.png');?>") left -68px no-repeat; background-size: 33px auto; }
            .icon_lock { background: url("<?php echo $this->asset->makeUrl('v1/images/oauth/mobile/haha/icon.png');?>") left -1px no-repeat; background-size: 33px auto; }
            .icon_red_ok { background: url("<?php echo $this->asset->makeUrl('v1/images/oauth/mobile/haha/icon.png');?>") left -102px no-repeat; margin-top: 0; background-size: 33px auto; }

            .login_text { text-align: right; line-height: 30px; font-size: 14px; }

            .login_promptText { position: relative; padding: 5px 10px 5px 25px; border: 1px solid #e4e3e8; margin: 10px 0px; color: #000;background: #fff url("<?php echo $this->asset->makeUrl('v1/images/oauth/mobile/haha/icon_tips.png');?>") no-repeat 10px 10px; background-size: 11px 11px; border-radius: 3px; }
                .login_promptText p { color: #343434; font-size: 12px; }


            /*重写的样式*/
            .ui_title { height: 45px; text-align: center; font-size: 16px; line-height: 45px; background: #ee4634; position: relative;color: #fff; }
                .ui_title a { color: #fff; }
                .ui_title .ui_back { position: absolute; left: 10px; font-size: 14px; }
            .ui_icon_back {background: url("<?php echo $this->asset->makeUrl('v1/images/oauth/mobile/haha/icon_back.png');?>") 0px 0px no-repeat; width: 13px; height: 20px; display: inline-block; background-size: 9px 17px; margin: 0 5px 0 0px; vertical-align: middle; }
            .a_login{ position: absolute; right: 10px;}

            .ui_register { padding-bottom: 15px; margin: 0 20px; }
                .ui_register .form_box { background: #f5f5f9; margin: 0px auto 20px; border: none;}
            .ui_reg_input { height: 44px; border: none; border-radius: 0px; font-size: 15px; display: block; -webkit-box-flex: 1; font-family: "微软雅黑","Microsoft YaHei"; min-width: 250px; }
            .ui_register .border_b { padding: 0px; border: 1px solid #e4e3e8; display: -webkit-box; margin-bottom: 10px; overflow: hidden; border-radius: 3px; background: #fff; line-height: 44px;}
                .ui_register .border_b:last-child { border: none; }
            .ui_register .no_border { border: none; }
            .ui_register .yz_img { display: inline-block; line-height: 44px; width: 80px; padding-left: 18px; }
                .ui_register .yz_img img { vertical-align: middle; width: 80px; }
            .ui_register .reg_finish_btn { height: 48px; width: 100%; line-height: 48px; color: #fff; background: #ee4634; border: none; border-radius: 5px; font-size: 18px;display: block; text-align: center; }

            .ui_footer { padding-top: 15px; font-size: 14px; font-size: 1.4rem; text-align: center; color: #999999; }
            .ui_register .reg_finish_btn[disabled=disabled] { background-color: #ee4634; color: rgba(255,255,255,0.5); opacity:1;}
            .dl_yanzhengma { width: 150px; border-left: 1px solid #dadcdd; text-align: right;float: right; }
                .dl_yanzhengma img { vertical-align: middle; width: 70px; height: 28px; overflow: hidden; margin: -5px 12px 0 7px; }
            .icon_edit { float: left; width: 33px; }

            .re_left { float: left; width: 70px; height: 44px; line-height: 44px; padding-left: 10px; font-size: 15px;}
            .re_right { width: 80px; float: right; height: 44px; line-height: 44px; }
            .re_center { margin-left: 80px; margin-right: 82px; height: 44px; line-height: 44px; }
            .re_center input {width: 100%; height: 44px; border: none; border-radius: 0px; font-size: 15px; display: block; font-family: "微软雅黑","Microsoft YaHei"; }
            .border_b span{ width: 70px; display: inline-block; line-height: 44px; padding-left: 10px; font-size: 15px; color: #000;}
            .border_bs{background: #fff;margin-bottom: 10px; overflow: hidden; border-radius: 3px; background: #fff;border: 1px solid #e4e3e8;}
        </style>
        {if isset($fzjs)}
        <script type="text/javascript" src="{$fzjs}"></script>
        {/if}
    </head>
    <body>
        <div class="p_login_new">
            <div class="ui_title">
                <a href="https://cytfinance.wangxinlicai.com/Pwap/User/login?mobile={$mobile}{if !$mobile}{$account}{/if}" class="fr f14 a_login">登录</a>
                <a class="ui_back" href="https://cytfinance.wangxinlicai.com/Pwap/">
                    <i class="ui_icon_back"></i>返回
                </a>注册
            </div>
            <div class="login_banner">
                <!--图片中的logo-->
                <img src="<?php echo $this->asset->makeUrl('v1/images/oauth/mobile/haha/logo_banner.png');?>" width="100%">
            </div>
            <div class="ui_register" id="JS-regpanel">
                <div class="login_promptText">
                    <p>为了您的账户安全，请设置财富密码。为方便记忆，建议与哈哈农庄密码相同</p>
                </div>
                <!--表单-->
                <form id="register_form" name="register_form" action="/user/doRegister{$querystring}" method="POST">
                    <input id="telCode" type="hidden" name="code" value="" />
                    <input type="hidden" name="type" value="h5" />
                    <input type="hidden" name="agreement" value="1" />
                    <input type="hidden" name="from_site" value="{$from_site}" />
                    <input id="mobile" type="hidden" name="mobile" value="{$mobile}{if !$mobile}{$account}{/if}" />
                    <?php echo token_input(); ?>
                    <div class="form_box clearfix">
                        <div class="border_b">
                            <span>账号</span>
                            <font class="colorRed ui_reg_input">{$mobile}{if !$mobile}{$account}{/if}</font>
                        </div>
                        <div class="border_b">
                            <span>密码</span>
                            <!--密码-->
                            <input id="password" name="password" type="password" class="ui_reg_input" placeholder="6-20位数字/字母/标点">

                        </div>
                        <div class="border_b">
                            <span>确认密码</span>
                            <!--密码-->
                            <input id="confirm_password" name="confirm_password" type="password" class="ui_reg_input" placeholder="6-20位数字/字母/标点">

                        </div>
                        <div class="border_b">
                            <span>邀请码</span>
                            <!--此处填写的是哈哈的邀请码-->
                            <input id="h_code" type="text" class="ui_reg_input" placeholder="理财邀请码">
                            <!--注意:这个隐藏域才是 通过上一个哈哈邀请码异步获取的 网信注册邀请码-->
                            <input id="invite" name='invite' type='hidden' value="FKNTH5" />
                        </div>
                        <div class="border_bs">
                            <div class="re_left"><span>验证码</span></div>
                            <div class="re_right dl_yanzhengma"><img title="验证码图片" alt="验证码图片" src="" /></div>
                            <div class="re_center"><input name="captcha" id="captcha" type="text" class=" input_yanzhengma" placeholder="右侧验证码"></div>
                        </div>
                    </div>
                    <div>
                        <input id="register_btn" type="button" class="reg_finish_btn fontHY" value="提交">
                    </div>
                    <div class="tc pt10 f14">注册即视为同意<a href="#" class="blue JS-regterm" style="text-decoration:underline;">注册协议</a></div>
                </form>
            </div>

        </div>

        <script type="text/javascript">
            var _wxJsonPCallbackIndex = 0;
            function wxJsonP(urlbase, suc_callback, err_callback) {
                var scripttag = document.createElement("script");
                _wxJsonPCallbackIndex++;
                var callbackkey = "_wxJsonPPrefix" + _wxJsonPCallbackIndex;
                window[callbackkey] = function(result){
                    suc_callback.call(null, result);
                    delete window[callbackkey];
                };
                scripttag.onload = function() {
                    if (window[callbackkey]) {
                        err_callback.call(null);
                        delete window[callbackkey];
                    }
                    document.body.removeChild(scripttag);
                };
                scripttag.onerror = function() {
                    err_callback.call(null);
                    delete window[callbackkey];
                    document.body.removeChild(scripttag);
                };
                scripttag.src = urlbase + (urlbase.indexOf("?") == -1 ? "?" : "&") + "callback=" + callbackkey;
                document.body.appendChild(scripttag);
            }
            //获取URL参数
            function getUrlParam(name) {
                var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
                var r = window.location.search.substr(1).match(reg);
                if (r != null) return unescape(r[2]); return null;
            }
            $(function(){
                //判断是否有优惠码
                if (getUrlParam("hhcn") != null&&getUrlParam("hhcn").length>0) {
                    $("#h_code").val(getUrlParam("hhcn")).attr("disabled","disabled");
                }
                var _inMcodeRequest = false;
                // 按钮disable状态逻辑
                function upateSubmitButton() {
                    var disabled = _inMcodeRequest || $('#password').val() == '' || $('#confirm_password').val() == '' || $('#captcha').val() == '';
                    if (disabled) {
                        $('#register_btn').attr('disabled', 'disabled');
                    } else {
                        $('#register_btn').removeAttr('disabled');
                    }
                }
                $('#password').bind("input", upateSubmitButton);
                $('#confirm_password').bind("input", upateSubmitButton);
                $('#captcha').bind("input", upateSubmitButton);
                var _upateSubmitButtonCount = 10;
                var _upateSubmitButtonTimer = setInterval(function(){
                    upateSubmitButton();
                    _upateSubmitButtonCount--;
                    if (_upateSubmitButtonCount < 0) {
                        clearInterval(_upateSubmitButtonTimer);
                    }
                }, 300);

                // 图片验证码逻辑
                function updateCaptchaImg() {
                    $('.dl_yanzhengma img').attr('src', '/verify.php?w=40&h=20&rb=0&rand=' + new Date().valueOf());
                }
                $('.dl_yanzhengma').click(function() {
                    updateCaptchaImg();
                });
                updateCaptchaImg();

                // 显隐密码
                var _pwdFlag = false;
                function updatePassWordStyle(show) {
                    $('#password')[0].type = show ? 'text' : 'password';
                    $('#pwd_show_btn')[0].innerHTML = show ? '隐藏' : '显示';
                }
                $('#pwd_show_btn').bind("click", function(){
                    _pwdFlag = !_pwdFlag;
                    updatePassWordStyle(_pwdFlag);
                });


                //更换邀请码
                function replace_code() {
                    var domain = "/third/convertCode"; //测试时 可以换成 http://cytfinance.com
                    wxJsonP(domain+"?hcode=" + $("#h_code").val(), function(result){
                        if (result.status) {
                            //替换网信邀请码
                            $('#invite').val(result.data.wx_code);
                        }
                        getMCode();
                    }, function(){
                        getMCode();
                    });


                    //$.ajax({
                    //    url: apiUrl,
                    //    type: "GET",
                    //    dataType: 'jsonp',
                    //    jsonp: 'callback',
                    //    data: data,
                    //    success: function(result) {
                    //        if (result.status) {
                    //            //替换网信邀请码
                    //            $('#invite').val(result.data.wx_code);
                    //        }
                    //        getMCode();
                    //    },
                    //    error: function() {
                    //        getMCode();
                    //    }
                    //});

                }


                // step1
                $('#register_btn').click(function(event) {
                    if (_inMcodeRequest) return;
                    // 密码
                    var reg = /^[^\s]{6,20}$/m;
                    var spaceReg = / /;
                    if (!reg.test($('#password')[0].value)) {
                        P2PWAP.ui.showErrorTip('安全码不正确\<br\/\>（6-20位数字/字母/标点）');
                        return;
                    }
                    if($('#confirm_password').val() != $('#password').val()){
                        P2PWAP.ui.showErrorTip('两次密码不一致');
                        return;
                    }
                    // 验证码
                    if(!P2PWAP.common.checkCaptcha($('#captcha')[0])){
                        return;
                    }
                    if ($("#h_code").val().length > 0) {
                        replace_code();
                    } else {
                        getMCode();
                    }
                });

                function getMCode(){
                    _inMcodeRequest = true;
                    upateSubmitButton();
                    P2PWAP.util.ajax('/user/MCode', 'post', function(obj){
                        _inMcodeRequest = false;
                        upateSubmitButton();
                        if (obj.code == 1){
                            var sendingAjax;
                            $('body').append('<div class="ui-popup-wrap"></div>');
                            var html= '';
                            html += '<div class="ui-pop-box reg_send_box" style="margin-top:-122px;top:50%">';
                            html += '    <div class="pop-head">';
                            html += '        <h1>填写短信验证码</h1>';
                            html += '        <div class="pop_close"></div>';
                            html += '    </div>';
                            html += '    <div class="pop-body">';
                            html += '        <p class="tc">已向'+ $('#mobile').val().replace(/(\d{3})\d{4}(\d{4})/, function(_0, _1, _2) {return _1 + "****" + _2 }) +'发送验证短信</p>';
                            html += '        <div class="pop-form">';
                            html += '            <form id="" name="" method="POST" onsubmit="return false;">';
                            html += '                <div class="form_mid">';
                            html += '                    <div class="ipt-list">';
                            html += '                        <div class="txt-wrap">';
                            html += '                            <input id="telCaptcha" class="img-yanzheng" type="text" maxlength="6" placeholder="短信验证码" name="telCaptcha">';
                            html += '                        </div>';
                            html += '                        <div class="resend"><input id="action-send-code" type="button" class="re-btn blue sending" value="正在获取中" disabled="disabled"/></div>';
                            html += '                    </div>';
                            html += '                </div>';
                            html += '                <div class="btn-wrap">';
                            html += '                    <input id="telCodeSendBtn" class="pop-btn btn-ok" type="button" value="完成" />';
                            html += '                </div>';
                            html += '            </form>';
                            html += '        </div>';
                            html += '    </div>';
                            html += '</div>';
                            $('.ui-popup-wrap').html(html);
                            P2PWAP.ui.updateTimeLabel($('#action-send-code')[0],125);
                            P2PWAP.ui.btnDisableType([$('#telCaptcha')[0]], $('#telCodeSendBtn')[0]);

                            $('.ui-popup-wrap .pop_close').click(function(event) {
                                if(sendingAjax) sendingAjax.abort();
                                $('.ui-popup-wrap').remove();
                            });

                            $('#action-send-code').click(function(event) {
                                var $this = $(this);
                                $this.addClass('sending').attr('disabled','disabled');
                                sendingAjax = P2PWAP.util.ajax('/user/MCode', 'post', function(obj){
                                    if (obj.code == 1){
                                        P2PWAP.ui.updateTimeLabel($('#action-send-code')[0],125);
                                    } else {
                                        P2PWAP.ui.showErrorTip(obj.message);
                                        $this.removeClass('sending').removeAttr('disabled');
                                    }
                                    sendingAjax = null;
                                }, function(msg){
                                    P2PWAP.ui.showErrorTip(msg);
                                    sendingAjax = null;
                                }, {
                                    type: '1',
                                    isrsms: '0',
                                    t: new Date().getTime(),
                                    mobile: $('#mobile').val(),
                                    token: $('#token').val(),
                                    token_id: $('#token_id').val(),
                                    password: $("#password").val(),
                                    captcha: $('#captcha').val()
                                });
                            });

                            $('#telCodeSendBtn').click(function(event) {
                                var val = $('#telCaptcha').val();
                                if (!/^\d{6}$/.test(val)) {
                                    P2PWAP.ui.showErrorTip('请填写6位数字验证码');
                                } else {
                                    $('#telCode').val(val);
                                    $('#register_form').submit();
                                }
                            });
                        } else {
                            P2PWAP.ui.showErrorTip(obj.message);
                        }
                    }, function(msg){
                        _inMcodeRequest = false;
                        upateSubmitButton();
                        P2PWAP.ui.showErrorTip(msg);
                    }, {
                        type: '1',
                        isrsms: '0',
                        t: new Date().getTime(),
                        mobile: $('#mobile').val(),
                        token: $('#token').val(),
                        token_id: $('#token_id').val(),
                        captcha: $('#captcha').val(),
                        client_id: '{$client_id}',
                        password: $("#password").val(),
                        invite:$("#invite").val()
                    });
                }

                {if isset($errorMsg)}
                P2PWAP.ui.showErrorTip('{$errorMsg}');
                {/if}
                });
        </script>


        <script type='text/javascript'>
                    var _ncf = {"prd": "firstp2p", "pstr": "", "pfunc": null, "pcon": "", "pck": {"channel": "channel", "fpid": "fpid"}, "trid": "", "channel": ['pubid', 'mediumid', 'adid', 'adsize'], "rfuniq": [], "rfmuti": []};
            (function(p, h, s) {
                var o = document.createElement(h);
                o.src = s;
                p.appendChild(o)
            })(document.getElementsByTagName("HEAD")[0], "script", "<?php echo $this->asset->makeUrl('default/js/ncfpb.1.5.min.js');?>");
        </script>
        <!--  注册协议 -->
        <script type="text/javascript">
            var rootDomain='{$rootDomain}';
            {if $isMaster == 1}
            var explain = "备案号为：京ICP证130046号，以下简称网信理财",
                isMaster = true;
            {else}
            var explain = "以下简称网信理财",
                isMaster = false;
            {/if}

        </script>
        <script type="text/javascript" src="<?php echo $this->asset->makeUrl('v2/js/event/register_terms.js');?>"></script>
    </body>
</html>
