<?php
/**
 * 修复存管未激活用户tag
 * author: weiwei12@ucfgroup.com
 */

require(dirname(__FILE__) . '/../../app/init.php');
use libs\utils\Logger;
use libs\db\Db;
use core\dao\AccountAuthorizationModel;

set_time_limit(0);
ini_set('memory_limit', '2048M');
$db = Db::getInstance('firstp2p');

$content = file_get_contents('http://static.firstp2p.com/attachment/201801/31/18/4938fe2f4ac67bcffcea3793a634384b/11489de5cb2584deb50a821b892f9157.csv');
$userIds = explode("\n", $content);

$count = count($userIds);
Logger::info(sprintf('start repaire_user_tag, count: %s', $count));

foreach ($userIds as $index => $userId) {
    $userId = intval($userId);
    if (empty($userId)) {
        continue;
    }

    $sql = sprintf('REPLACE INTO `firstp2p_user_tag_relation`(uid, tag_id) VALUES (%d, 1304)', $userId);
    $result = $db->query($sql);
    if (!$result) {
        Logger::error(sprintf('delete_account_auth error, userIds: %s', json_encode($groupIds)));
    }
}

$delUserIds = [8538809, 8224564, 7986473, 8506856, 8513507, 8561070, 7576207, 8392779, 7997965, 7967527, 7380760, 7843428, 8548081, 7328525, 8689117, 7442881, 7448445, 7525990, 7730082, 7462848, 7490345, 7493224, 7592194, 7939793, 8061548, 7424640, 7483463, 8649948, 8664720, 8656841, 7389198, 7462151, 8553868, 7469186, 7504468, 8584058, 7431532, 8719785, 8451828, 7483680, 7450580, 7558726, 7280547, 7969871, 7411492, 7725499, 8658545, 8614795, 7594891, 7439957, 7362878, 8776742, 8168377, 8658579, 7971854, 7532731, 8291126, 7672363, 8045668, 8090384, 7344825, 7607740, 7947758, 8599939, 8443744, 8586781, 8637049, 8516347, 7476548, 7568201, 8005745, 7436672, 7932420, 8463363, 7567976, 7736629, 8489394, 7593842, 8796395, 8130560, 7421874, 8715810, 8561995, 7382713, 8454485, 7934877, 7430527, 7465963, 7580601, 7119111, 7754404, 7436139, 7591913, 8513965, 7508077, 7426914, 7429821, 8279888, 8663226, 7385730, 7426766, 8562145, 7965932, 8602865, 8697755, 8721418, 7376929, 7481164, 7439202, 7514509, 8656953, 7306175, 7617870, 7484333, 8062281, 7555406, 8622570, 8754437, 7740423, 7635484, 7593936, 8223975, 7943682, 7660772, 8650997, 8136377, 7166878, 7496112, 7495742, 7443423, 968595, 8451983, 8606141, 8713768, 8006859, 8089937, 7399371, 7407478, 7651709, 8287063, 7463320, 8338806, 8689206, 8516207, 8454447, 7482775, 8160717, 8373069, 8262094, 7462504, 8606003, 7378643, 7933575, 7357891, 7453041, 7974350, 7423784, 8044971, 7368409, 8605781, 7660135, 7943816, 7365872, 8514018, 8717103, 8677778, 8673202, 8754371, 8375793, 8062346, 8161010, 7508598, 8024534, 8717685, 7464659, 7320217, 8481180, 8540699, 8061246, 7547948, 7448457, 7499601, 7807678, 7596420, 7355428, 7880202, 8452035, 7589928, 7452515, 7736610, 7949844, 7452019, 7427564, 7383820, 7922500, 7678626, 3719656, 7523288, 7428343, 8023851, 7499861, 7749651, 8761977, 8515530, 8767151, 7368652, 7657066, 7590181, 7542821, 8378648, 7689566, 8139832, 7542156, 8065363, 7501624, 7467272, 7483459, 7404090, 7575171, 8642691, 7550012, 7481783, 7550472, 7479804, 8775609, 7966091, 7412317, 7701308, 7589903, 7977054, 8045684, 8600991, 8697657, 8698042, 7438250, 7404139, 8004738, 7967180, 7399148, 7500390, 7961436, 7976023, 8643035, 8752503, 7528874, 7559819, 7934534, 7500378, 7565798, 7934469, 7376599, 8224379, 7522998, 8791809, 7382634, 7457405, 8638246, 7435218, 6885868, 7409462, 7999773, 8279638, 8451156, 8778364, 8090584, 7550644, 8208020, 7408726, 7640246, 7594476, 7596435, 7660460, 7568887, 7431867, 7439207, 7756833, 8600841, 8044417, 7333986, 7466211, 8158985, 7460413, 8031701, 7357758, 8615041, 8596047, 7651472, 8776116, 7574688, 8379210, 7587130, 8302526, 7894958, 7733642, 7537612, 8451421, 8718411, 8686755, 7722996, 7499621, 7557430, 7520878, 7804883, 7404485, 7358939, 7431116, 7590265, 8324859, 7596055, 8637271, 7498167, 7483932, 7586826, 7431377, 7518946, 7542940, 8187138, 7070902, 8637633, 8090014, 7460529, 8514596, 7426732, 7525074, 7397514, 7500125, 8609117, 7427569, 8332533, 8061437, 7518769, 7453891, 7465957, 8023869, 8845752, 8093597, 8845744, 8845723, 8846224, 8827354, 8847667, 8847009, 8194389, 8849898, 8850801, 8849454, 8847134, 8847417, 8048249, 8847349, 8859675, 8860025, 7849339, 7499016, 8483214, 8847747, 7336462, 8004342, 7624543, 7569684, 7327708, 8582063, 7483989, 7547734, 7589936, 7821828, 8170153, 8170172, 7935953, 8287418, 7997013, 7370251, 7424322, 7495841, 7412390, 8098908, 8720459, 7450427, 7351149, 7413598, 7268104, 7756652, 7510324, 8489722, 7769920, 7500921, 8416174, 8560995, 8504862, 8724739, 7602679, 7688089, 7479705, 7435310, 7749890, 8338081, 7883978, 8662506, 6456026, 6487541, 2717796, 2829415, 5701112, 3839136, 4819210, 3926584, 3979005, 6719422, 6706073, 6877313, 6805027, 6816805, 6999631, 6951198, 6876350, 6876415, 6880490, 6968434, 6996338, 6996049, 6996155, 6888219, 6970308, 8830328, 8827268, 8834423, 8829830, 8825107, 7548613, 8824995, 8836238, 8767122, 8825056, 8826581, 8829883, 7594177, 8835276, 8829917, 8830545, 7683362, 7525117, 8836783, 8849374, 8875364, 8875444, 8875924, 8850789, 8846773, 8845933, 8847865, 8867171, 8864070, 7596703, 8829676, 8846855, 8846191, 8864775, 8853362, 7427872, 8826254, 8847072, 8845558, 14820, 7022970, 7005201, 7018368, 7020231, 7044508, 7030113, 7046559, 410097, 7048188, 7091439, 6070981, 7065942, 7112107, 7120049, 6157471, 7119749, 7128108, 7139729, 7143625, 7142867, 7186062, 7186487, 7149906, 7181763, 7196882, 7165835, 7191554, 7191791, 7179510, 7165669, 7211381, 7221564, 7207997, 7208072, 4294122, 1335962, 7218352, 7218936, 7260112, 7260795, 7246500, 7248813, 7249628, 7275647, 7276342, 7252607, 7273475, 6307338, 7270978, 7269790, 7276729, 7316814, 7317289, 7313351, 7289434, 7290514, 7298604, 7306713, 7307502, 7307303, 7310091, 6383011, 7299714];

foreach ($delUserIds as $userId) {
    $userId = intval($userId);
    if (empty($userId)) {
        continue;
    }
    $sql = sprintf('DELETE FROM `firstp2p_user_tag_relation` WHERE `uid` = %d AND `tag_id` = 1304', $userId);
    $result = $db->query($sql);
    if (!$result) {
        Logger::error(sprintf('delete_account_auth error, userIds: %s', json_encode($groupIds)));
    }
}

Logger::info(sprintf('end repaire_user_tag, count: %s, delCount: %s', $count, count($delUserIds)));



