{// 引入标签库 }
<tagLib name="html" />
<include file="Public:header" />
<load href='__TMPL__Common/js/conf.js' />
<script type="text/javascript" src="__TMPL__Common/js/calendar/calendar_lang.js" ></script>
<load href='__TMPL__Common/js/jquery.bgiframe.js' />
<load href='__TMPL__Common/js/jquery.weebox.js' />
<load href='__TMPL__Common/style/weebox.css' />
<script type="text/javascript">
    var checkLoanMoney=function()
    {
        var min=parseFloat($('#min_loan_money').val());
        var max=parseFloat($('#max_loan_money').val());
        if(max > 0 && min >0)
        {
            if(max<min)
            {
                alert('最大金额不能小于最小金额');
                return false;
            }
        }
    };
    window.onload = function()
    {
        dealcrowd();
        $('#min_loan_money').blur(checkLoanMoney);
        $('#max_loan_money').blur(checkLoanMoney);
        $('#deal_crowd').change(dealcrowd);
        //$('#min_loan_money').val(Math.ceil($("#apr").val()/200));
    }

    $(document).ready(function () {
        // 年化借款平台手续费-收费方式 显示不同的标签
        if ($('#loan_fee_type_3').attr('checked') || $('#loan_fee_type_7').attr('checked')) { // 分期收、固定比例分期收
            $('#loan_fee_custom_input').html($('#loan_fee_installment').html());
        } else if ($('#loan_fee_type_4').attr('checked')) {
            $('#loan_fee_custom_input').html($('#loan_fee_proxy').html());
        }

        // 更新分期收总金额
        calc_fenqi_fee('loan_fee', 0);
    });
</script>

<load href='__TMPL__Common/js/calendar/calendar.css' />
<load href='__TMPL__Common/js/calendar/calendar.js' />
<load href='__TMPL__Common/js/deal.js' />

<div class="main">
    <div class="main_title">{$vo.name}{%EDIT} <a href="<if condition="$vo['deal_type'] eq 1">{:u("Deal/compound")}<else/>{:u("Deal/index")}</if>" class="back_list">{%BACK_LIST}</a></div>
    <div class="blank5"></div>
    <form name="edit" action="__APP__" id='editform' method="post" enctype="multipart/form-data">
        <div class="button_row">
            <input type="button" class="button conf_btn" rel="1" value="{%DEAL_BASE_INFO}" />&nbsp;
            <input type="button" class="button conf_btn" rel="2" value="{%SEO_CONFIG}" />&nbsp;
        </div>
        <div class="blank5"></div>
        <table class="form conf_tab" cellpadding=0 cellspacing=0 rel="1">
            <tr>
                <td colspan=2 class="topTd"></td>
            </tr>
            <tr>
                <td class="item_title">旧版借款标题:</td>
                <td class="item_input">
                    <if condition="$vo['deal_status'] eq 0">
                        前&nbsp;缀：<input  type="text" class="textbox" name="prefix_title" style="width:500px;" value="{$vo.prefix_title}" <if condition="$vo['publish_wait'] eq 0 and $vo['parent_id'] neq -1">disabled title='只有审核之后的子母标不可以编辑'</if>/>&nbsp;<font color="#ff2121">文本最末端请输入逗号(中文全角)</font>
                        <br />
                        主标题：<input type="text" class="textbox" name="main_title" style="width:500px;" readonly="readonly" value="{$vo.main_title}"/>
                        <else />
                        <input type="text" class="textbox" name="main_title" style="width:500px;" disabled="disabled" value="{$vo.prefix_title}{$vo.main_title}"/>
                    </if>
                </td>
            </tr>
           <tr>
                <td class="item_title">标的产品名称:</td>
                <td class="item_input">
                    <input type="text" name="name" value="{$vo.name}" readOnly="true" style="width:500px;" />
                </td>
            </tr>
    <tr>
        <td class="item_title">会员:</td>
        <td class="item_input">
            <span id='borrower_info'>{:get_user_name($vo['user_id'])}
                <a href="__APP__?m=User&a=passed&id={$vo.user_id}" target="_blank">资料认证</a>
                <?php
                    if(intval($userInfo['idcardpassed']) !== 1) {
                        echo '<span style="color:red;">身份未认证</span>';
                    }else{
                        echo '身份已认证';
                    }
                ?>
                <?php
                    if(intval($userInfo['audit']['status']) !== 1) {
                        echo '<span style="color:red;">银行卡未审核</span>';
                    }else{
                        echo '银行卡已验证';
                    }
                ?>
                用户姓名:{:!empty($userInfo['company_name']) ? $userInfo['company_name'] : $userInfo['real_name'];}
                &nbsp;
                用户类型:{$userInfo['user_type_name']}
            </span>
                    <if condition="$pro['id']">
                        <!-- 不可修改 -->
                        <elseif condition="$vo['deal_status'] eq 0 or $vo['deal_status'] eq 1" />
                        <a href="javascript:void(0)" onclick='edit_borrower()'>修改</a>
                    </if>
                </td>
            </tr>

            <if condition="!empty($guarantor)">
                <tr>
                    <td class="item_title">借款保证人:</td>
                    <td class="item_input">
                        <foreach name="guarantor" item="gu">
                            <div style="width: 80px;float: left;">{$gu.name}</div>
                            <a href="__APP__?m=DealGuarantor&a=index&did={$vo.id}&gid={$gu.id}" target="_blank">{$gu.status_name}</a>
                            <notempty name="gu['to_user_id']"><a href="__APP__?m=User&a=passed&id={$gu.to_user_id}" target="_blank">身份审核</a></notempty>
                            <br/>
                        </foreach>
                </tr>
            </if>
            <tr>
                <td class="item_title">{%CATE_TREE}:</td>
                <td class="item_input">
                    <select name="cate_id" class="require">
                        <option value="0">=={%NO_SELECT_CATE}==</option>
                        <foreach name="deal_cate_tree" key="dkey" item="cate_item">
                            <option value="{$cate_item.id}" <if condition="$vo['cate_id'] eq $cate_item['id']">selected="selected"</if> <if condition="$vo['publish_wait'] eq 1 and $vo['cate_id'] eq 0 and $dkey eq 2">selected="selected"</if>>{$cate_item.title_show}</option>
                        </foreach>
                    </select>
                </td>
            </tr>

            <tr>
                <td class="item_title">担保/代偿I机构:</td>
                <td class="item_input">
                    <select name="agency_id" class="require"  <if condition="$pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0">disabled</if>>
                        <option value="0">无</option>
                        <foreach name="deal_agency" item="agency_item">
                            <option value="{$agency_item.id}" <if condition="$vo['agency_id'] eq $agency_item['id']">selected="selected"</if>><if condition="$agency_item['short_name'] neq ''">{$agency_item.short_name}({$agency_item.name})<else/>{$agency_item.name}</if></option>
                        </foreach>
                    </select>
                    <span class="tip_span">机构担保标时可选择</span>
                </td>
            </tr>

            <tr>
                <td class="item_title">咨询机构:</td>
                <td class="item_input">
                    <select name="advisory_id" class="require"  <if condition="$pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0">disabled</if>>
                        <option value="0">无</option>
                        <foreach name="deal_advisory" item="advisory_item">
                            <option value="{$advisory_item.id}" <if condition="$vo['advisory_id'] eq $advisory_item['id']">selected="selected"</if>><if condition="$advisory_item['short_name'] neq ''">{$advisory_item.short_name}<else/>{$advisory_item.name}</if></option>
                        </foreach>
                    </select>
                    <!--  <span class="tip_span">机构担保标时可选择</span>
                    -->
                </td>
            </tr>

            <tr>
                <td class="item_title">渠道机构:</td>
                <td class="item_input">
                    <select name="canal_agency_id" class="require" onchange="javascript:change_canal(this.options[selectedIndex].value)"  <if condition="$pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0">disabled</if>>
                    <option value="0">无</option>
                    <foreach name="canal_agency" item="canal_item">
                        <option value="{$canal_item.id}" <if condition="$vo['canal_agency_id'] eq $canal_item['id']">selected="selected"</if>><if condition="$canal_item['short_name'] neq ''">{$canal_item.short_name}<else/>{$canal_item.name}</if></option>
                    </foreach>
                    </select>
                </td>
            </tr>

            <tr>
                <td class="item_title">支付机构:</td>
                <td class="item_input">
                    <select name="pay_agency_id" class="require"  <if condition="$pro['business_status'] neq $project_business_status['waitting']  and $vo['deal_status'] neq 0">disabled</if>>
                        <foreach name="pay_agency" item="pay_agency_item">
                            <option value="{$pay_agency_item.id}" <if condition="$vo['pay_agency_id'] eq $pay_agency_item['id']">selected="selected"</if>><if condition="$pay_agency_item['short_name'] neq ''">{$pay_agency_item.short_name}<else/>{$pay_agency_item.name}</if></option>
                        </foreach>
                    </select>
                </td>
            </tr>
            <tr id="management_agency_tr" style="display:none">
                <td class="item_title">管理机构:</td>
                <td class="item_input">
                    <select name="management_agency_id" class="require"  <if condition="$pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0">disabled</if>>
                        <foreach name="management_agency" item="management_agency_item">
                            <option value="{$management_agency_item.id}" <if condition="$vo['management_agency_id'] eq $management_agency_item['id']">selected="selected"</if>><if condition="$management_agency_item['short_name'] neq ''">{$management_agency_item.short_name}<else/>{$management_agency_item.name}</if></option>
                        </foreach>
                    </select>
                </td>
            </tr>
            <tr>
                <td class="item_title">担保/代偿II-b机构:</td>
                <td class="item_input">
                    <select name="advance_agency_id"  <if condition="$pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0">disabled</if>>
                        <option value="0">=={%NO_SELECT_AGENCY}==</option>
                        <foreach name="advance_agency" item="advance_agency_item">
                            <option value="{$advance_agency_item.id}" <if condition="$vo['advance_agency_id'] eq $advance_agency_item['id']">selected="selected"</if>><if condition="$advance_agency_item['short_name'] neq ''">{$advance_agency_item.short_name}<else/>{$advance_agency_item.name}</if></option>
                        </foreach>
                    </select>
                </td>
            </tr>

            <if condition="$vo['deal_type'] eq 2">
                <tr id="jys">
                    <td class="item_title">交易所:</td>
                    <td class="item_input">
                        <select name="jys_id" id="jys_id"  <if condition="$pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0">disabled</if>>
                        <option value="0">=={%NO_SELECT_AGENCY}==</option>
                        <foreach name="jys" item="jys_item">
                            <option value="{$jys_item.id}" <if condition="$vo['jys_id'] eq $jys_item['id']">selected="selected"</if>><if condition="$jys_item['short_name'] neq ''">{$jys_item.short_name}<else/>{$jys_item.name}</if></option>
                        </foreach>
                        </select>
                    </td>
                </tr>
            </if>

            <if condition ="$vo['deal_type'] eq 0">
            <tr>
                <td class="item_title">代充值机构:</td>
                <td class="item_input">
                    <select name="generation_recharge_id"  <if condition="$pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0">disabled</if>>
                    <option value="0">=={%NO_SELECT_AGENCY}==</option>
                    <foreach name="generation_recharge" item="generation_recharge_item">
                        <option value="{$generation_recharge_item.id}" <if condition="$vo['generation_recharge_id'] eq $generation_recharge_item['id']">selected="selected"</if>><if condition="$generation_recharge_item['short_name'] neq ''">{$generation_recharge_item.short_name}<else/>{$generation_recharge_item.name}</if></option>
                    </foreach>
                    </select>
                </td>
            </tr>
            </if>
            <if condition ="$vo['deal_type'] eq 3">
            <tr id="entrust_agency_tr">
                <td class="item_title">受托机构:</td>
                <td class="item_input">
                    <select name="entrust_agency_id" id="entrust_agency_id" class="require"  <if condition="$pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0">disabled</if>>
                        <option value="">=={%NO_SELECT_AGENCY}==</option>
                        <foreach name="entrust_agency" item="entrust_agency_item">
                            <option value="{$entrust_agency_item.id}" <if condition="$vo['entrust_agency_id'] eq $entrust_agency_item['id']">selected="selected"</if>><if condition="$entrust_agency_item['short_name'] neq ''">{$entrust_agency_item.short_name}<else/>{$entrust_agency_item.name}</if></option>
                        </foreach>
                    </select>
                </td>
            </tr>
            </if>

            <tr>
                <td class="item_title">担保范围:</td>
                <td class="item_input">
                    <select name="warrant"  <if condition="$pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0">disabled</if>>
                        <option value="0" <if condition="$vo['warrant'] eq 0">selected="selected"</if>>无</option>
                        <option value="1" <if condition="$vo['warrant'] eq 1">selected="selected"</if>>本金</option>
                        <option value="2" <if condition="$vo['warrant'] eq 2">selected="selected"</if>>本金及利息</option>
                        <option value="3" <if condition="$vo['warrant'] eq 3">selected="selected"</if>>有</option>
                        <option value="4" <if condition="$vo['warrant'] eq 4">selected="selected"</if>>第三方资产收购</option>
                    </select>
                </td>
            </tr>

            <tr>
                <td class="item_title">产品类别:</td>
                <td class="item_input">
                    <input type='hidden' id='lgl_type_tag' value='{$lgl_tag}' />
                    <input type='hidden' id='bxt_type_tag' value='{$bxt_tag}' />
                    <input type='hidden' id='dtb_type_tag' value='{$dtb_tag}' />
                    <input type='hidden' id='xffq_type_tag' value='{$xffq_tag}' />
                    <input type='hidden' id='zcgl_type_tag' value='{$zcgl_tag}' />
                    <select name="type_id" id='type_id' onchange="javascript:change_lgl_input()" <if condition="($vo['deal_status'] neq 0 and $vo['parent_id'] neq -1) or ($pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0)">disabled</if>>
                    <option value="0" type_tag='{$type_item.type_tag}'selected="selected">无</option>
                    <foreach name="deal_type_tree" item="type_item">
                        <option value="{$type_item.id}" type_tag='{$type_item.type_tag}' <if condition="$type_item['id'] eq $vo['type_id']">selected="selected"</if>>{$type_item.name}</option>
                    </foreach>
                    </select>
                </td>
            </tr>
            <tr>
                <td class="item_title">借款用途分类:</td>
                <td class="item_input">
                    <select name="loan_application_type"class="require"  id='loan_application_type'  <if condition="$pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0">disabled</if>>
                        <option value="0" <if condition="$deal_ext[loan_application_type] eq 0">selected="selected"</if>>其他</option>
                        <option value="1" <if condition="$deal_ext[loan_application_type] eq 1">selected="selected"</if>>企业经营</option>
                        <option value="2" <if condition="$deal_ext[loan_application_type] eq 2">selected="selected"</if>>短期周转</option>
                        <option value="3" <if condition="$deal_ext[loan_application_type] eq 3">selected="selected"</if>>日常消费</option>
                    </select>
                </td>
            </tr>

           <!-- <tr>
                <td class="item_title">上线网站编号</td>
                <td class="item_input">
                    <input type="text" class="textbox" name="line_site_id"  value="{$deal_ext.line_site_id}" maxlength="120"  <if condition="$pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0">readonly</if>/>
                </td>
            </tr>

            <tr>
                <td class="item_title">上线网站名称</td>
                <td class="item_input">
                    <input type="text" class="textbox" name="line_site_name"  value="{$deal_ext.line_site_name}" maxlength="120"  <if condition="$pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0">readonly</if>/>
                </td>
            </tr> -->



            <if condition="$vo['deal_type'] eq 1">
                <tr>
                    <td class="item_title">锁定周期:</td>
                    <td class="item_input">
                        <input type="text" class="textbox" name="lock_period"  id="lock_period" value="{$vo['lock_period']}"/> 天
                    </td>
                </tr>

                <tr>
                    <td class="item_title">赎回周期:</td>
                    <td class="item_input">
                        <input type="text" class="textbox" name="redemption_period"  id="redemption_period" value="{$vo['redemption_period']}"  onchange="javascript:changeRate('annualized_rate');"/> 天
                    </td>
                </tr>

                <tr class='lgl_input'>
                    <td class="item_title">终止日期:</td>
                    <td class="item_input">
                        <input type="text" class="textbox" name="end_date" id="end_date" value='{$vo.end_date}' onfocus="this.blur(); return showCalendar('end_date', '%Y-%m-%d', true,true, 'btn_end_date');" />
                        <input type="button" class="button" id=btn_end_date value="{%SELECT_TIME}" onclick="return showCalendar('end_date', '%Y-%m-%d', false, false, 'btn_end_date');" />
                    </td>
                </tr>

                <tr>
                    <td class="item_title">是否自动提现:</td>
                    <td class="item_input">
                        <label><input type="radio" name="is_auto_withdrawal" value="1" <if condition="$deal_ext['is_auto_withdrawal'] eq 1">checked="checked"</if> />是</label>
                        <label><input type="radio" name="is_auto_withdrawal" value="0" <if condition="$deal_ext['is_auto_withdrawal'] eq 0">checked="checked"</if> />否</label>
                    </td>
                </tr>
            </if>
            <!-- <tr class='lgl_input'>
                <td class="item_title">限制赎回系数:</td>
                <td class="item_input">
                    <input type="text" class="textbox" name="redemption_limit"  id="redemption_limit" value='{$deal_compound.redemption_limit}'/> %
                </td>
            </tr>
            <tr class='lgl_input'>
                <td class="item_title">日利率:</td>
                <td class="item_input">
                    <input type="text" class="textbox" name="rate_day"  id="rate_day" readonly value='{$deal_compound.rate_day}'/> %
                </td>
            </tr> -->

            <tr>
                <td class="item_title">借款用途详述:</td>
                <td class="item_input">
                    <html:editor id="use_info" name="use_info" style="width:500px;height:45px" content="{$deal_ext.use_info}" />
                </td>
            </tr>
            <tr>
                <td class="item_title">限定条件1:</td>
                <td class="item_input">
                    <select name="deal_crowd" id="deal_crowd" style="float: left;"  <if condition="($pro['business_status'] gt $project_business_status['process'] and $vo['deal_status'] gt 1) or $disabled_deal_crowd_34">disabled</if>>
                        <foreach name="deal_crowd" key="crow_key" item="crow_item">
                            <option value="{$crow_key}" <if condition="$crow_key eq $vo['deal_crowd']">selected="selected"</if>>
                            {$crow_item}</option>
                        </foreach>
                    </select>&nbsp;
                    <div style="float:left;margin-left:10px;display:none" id="specify_uid_dev">
                        <input placeholder="输入指定用户ID" value="{$specify_uid_info.id}" id="specify_uid" name="specify_uid" style="width:100px;" onblur="specify_blur()"  <if condition="$pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0">readonly</if>>
                        <span id="specify_user" style="color:red;font-size: 12px;">
                            <if condition="$specify_uid_info neq ''"> 姓名:{$specify_uid_info.real_name} 手机:{$specify_uid_info.mobile}</if>
                        </span>
                    </div>
                    <div style="float:left;margin-left:10px;display:none" id="specify_vip">
                        <foreach name="vipGrades" key="grade" item="gradeName">
                        <input type="radio" value="{$grade}" name="specify_vip" <if condition="($grade eq 1) or ($vo['deal_crowd'] eq 33 and $deal_ext['deal_specify_uid'] eq $grade)">checked </if> <if condition="$pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0">disabled</if>><if condition="$grade lt 6" >{$gradeName}及以上<else/>{$gradeName} </if>
                        </foreach>
                    </div>
                    <div id='user_group'>
                        <foreach name="usergroupList" key="ug_key" item="ug_item">
                            <input type="checkbox"  autocomplete='off' value="{$ug_item.id}" name="user_group[]" <if condition="array_search($ug_item['id'],$vo['user_group']) !== FALSE">checked="checked"</if>  <if condition="$pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0">readonly</if>>{$ug_item.name}
                        </foreach>
                    </div>
                </td>
            </tr>
            <tr>
                <td class="item_title">限定条件2:</td>
                <td class="item_input">
                    <select name="bid_restrict" id="bid_restrict"  <if condition="$pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0">disabled</if>>
                        <foreach name="bid_restrict" key="restrict_key" item="restrict_item">
                            <option value="{$restrict_key}" <if condition="$restrict_key eq $vo['bid_restrict']">selected="selected"</if>>
                            {$restrict_item}</option>
                        </foreach>
                    </select>
                </td>
            </tr>

            <tr>
                <td class="item_title">自定义标签:</td>
                <td class="item_input">
                    名称:<input type="text" class="textbox" name="deal_tag_name"  id = "deal_tag_name" value="{$vo.deal_tag_name}"   <if condition="$pro['business_status'] gt $project_business_status['process']">readonly</if>/>
                    描述:<input type="text" class="textbox" size="60" name="deal_tag_desc" id = "deal_tag_desc" value="{$vo.deal_tag_desc}" <if condition="$pro['business_status'] gt $project_business_status['process']">readonly</if>>
                </td>
            </tr>
            <tr>
                <td class="item_title">tag:</td>
                <td class="item_input">
                    <input type="text" class="textbox" name="deal_tags"  id = "deal_tags" size="90" value="{$vo.tags}"  <if condition="$pro['business_status'] gt $project_business_status['process']">readonly</if>/>
                    <span class="tip_span">tag之间以半角逗号分隔</span>
                </td>
            </tr>
           <!-- <tr>
                <td class="item_title">是否必须优惠码:</td>
                <td>
                    <select name="must_coupon" id="must_coupon"  <if condition="$pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0">disabled</if>>
                        <option value="0" <if condition="0 eq $deal_ext['must_coupon']">selected="selected"</if>>否 </option>
                        <option value="1" <if condition="1 eq $deal_ext['must_coupon']">selected="selected"</if>>是 </option>
                    </select>
                </td>
            </tr> -->
            <tr >
                <td class="item_title">达人专享:</td>
                <td class="item_input">
                    <input type="checkbox" id="daren" <if condition="$vo['min_loan_total_count'] gt 0 || $vo['min_loan_total_amount'] gt 0" > checked </if>  <if condition="$pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0">readonly</if>/>
                    <span class="loan_limit" <if condition="$vo['min_loan_total_count'] eq 0 && $vo['min_loan_total_amount'] eq 0" > style="display:none"</if> >
                    投资次数不少于:
                    <input type="text" class="textbox" name="min_loan_total_count"  id = "min_loan_total_count" value="{$vo.min_loan_total_count}"   <if condition="$pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0">readonly</if>/>
                    <select name="min_loan_total_limit_relation" id="min_loan_total_limit_relation"  <if condition="$pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0">disabled</if>>
                        <option value="0" <if condition="$vo['min_loan_total_limit_relation'] eq 0">selected="selected"</if>> 或者 </option>
                        <option value="1" <if condition="$vo['min_loan_total_limit_relation'] eq 1">selected="selected"</if>> 并且</option>
                    </select>
                    累计投资金额不少于:
                    <input type="text" class="textbox" name="min_loan_total_amount" id="min_loan_total_amount"  value="{$vo.min_loan_total_amount}"  <if condition="$pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0">readonly</if>/>

                    </span>
                </td>
            </tr>
            <tr>
                <td class="item_title">还款提醒短信</td>
                <td class="item_input">
                    <input type="checkbox" name="need_repay_notice" <if condition="$deal_ext['need_repay_notice'] eq 1"> checked="checked" </if> value="1"  <if condition="$pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0">readonly</if>/>
                </td>
            </tr>
            <tr>
                <td class="item_title">{%BORROW_AMOUNT}:</td>
                <td class="item_input">
                    <input type="text" class="textbox require" name="borrow_amount"  id = "apr" value="{$vo.borrow_amount}"   onchange="javascript:update_proxy_loan_info();" <if condition="($vo['publish_wait'] eq 0 and $vo['parent_id'] neq -1) or ($pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0)">readonly title='只有审核之后的子母标不可以编辑'</if>/><if condition="$pro['id']">  <font color='red'> 待上标金额： {$pro.left_money}</font> &nbsp; 项目总额：{$pro.borrow_amount} &nbsp; 已上标金额：{$pro.money_borrowed}</if>
                </td>
            </tr>

            <tr>
                <td class="item_title">最低金额:</td>
                <td class="item_input">
                    <input type="text" class="textbox require" name="min_loan_money" id="min_loan_money"  value="{$vo.min_loan_money}" <if condition="($vo['deal_status'] neq 0 and $vo['parent_id'] neq -1) or ($pro['business_status'] gt $project_business_status['process'])">disabled title='只有 进行中或之后状态的子母标 不可以编辑'</if>/>

                    <if condition="($vo['deal_type'] eq 2 or $vo['deal_type'] eq 3)">
                        <input type="checkbox" name="is_float_min_loan" value="1" <if condition="$vo['is_float_min_loan'] eq 1"> checked </if>>启用浮动起投金额
                    </if>

                </td>
            </tr>
            <tr>
                <td class="item_title">最高金额:</td>
                <td class="item_input">
                    <input type="text" class="textbox" id="max_loan_money" name="max_loan_money"  <empty name="vo.max_loan_money">value="0"<else /> value="{$vo.max_loan_money}"</empty> <if condition="$pro['business_status'] gt $project_business_status['process']">readonly</if>/>
                    <span class="tip_span">为0或为空时表示不做限制</span>
                </td>
            </tr>

            <tr>
                <td class="item_title">筹标期限:</td>
                <td class="item_input">
                    <input type="text" class="textbox" SIZE="8" name="enddate" value="{$vo.enddate}" <if condition="($vo['deal_status'] neq 0 and $vo['deal_status'] neq 1) or ($pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0)">disabled title='只有 等待确认和进行中的标 才可以编辑'</if>/>
                </td>
            </tr>

            <tr>
                <td class="item_title">还款方式:</td>
                <td class="item_input">
                    <select name="loantype" id="repay_mode" onchange="javascript:changeRepay('chg');" <if condition="($vo['deal_status'] gt 1 or $vo['parent_id'] neq -1) or ($pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0)">disabled title='等待确认和进行中可以编辑'</if>>
                    <foreach name="loan_type" key='type_key' item="type_item">
                        <if condition="$vo['deal_type'] eq 1">
                            <if condition="$type_key eq 5">
                                <option value="{$type_key}" <if condition="$type_key eq $vo['loantype']">selected="selected"</if>>{$type_item}</option>
                            </if>
                            <else />
                            <option value="{$type_key}" <if condition="$type_key eq $vo['loantype']">selected="selected"</if>>{$type_item}</option>
                        </if>
                    </foreach>
                    </select>
                </td>
            </tr>
            <tr>
                <td class="item_title">借款/转让期限:</td>
                <td class="item_input">
                    <select id="repay_period" name="repay_time" onchange="javascript:changeRepay('chg');" <if condition="($vo['deal_status'] gt 1  or $vo['parent_id'] neq -1) or ($pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0)">disabled title='等待确认和进行中可以编辑'</if>>
                    <foreach name="repay_time" key='time_key' item="time_item">
                        <option value="{$time_key}" <if condition="$time_key eq $vo['repay_time']">selected="selected"</if>>{$time_item}</option>
                    </foreach>
                    </select>
                    <input type="text" class="changepmt textbox" SIZE="8" onchange="javascript:changeRepay();" name="repay_time" id="repay_period2" <if condition="$vo.loantype eq 5">value="{$vo.repay_time}"</if> <if condition="($vo['deal_status'] gt 1 or $vo['parent_id'] neq -1) or ($pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0)">disabled title='等待确认和进行中可以编辑'</if>/> <span id='tian'>天</span>
                    <select id="repay_period3" name="repay_time" onchange="javascript:changeRepay();"  <if condition="($vo['deal_status'] gt 1  or $vo['parent_id'] neq -1) or ($pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0)">disabled title='等待确认和进行中可以编辑'</if>>
                    <foreach name="repay_time_month" key='time_key' item="time_item">
                        <option value="{$time_key}" <if condition="$time_key eq $vo['repay_time']">selected="selected"</if>>{$time_item}</option>
                    </foreach>
                    </select>
                </td>
            </tr>

            <tr>
                <td class="item_title">房产地址:</td>
                <td class="item_input">
                    <input type="text" class="textbox" name="house_address"  value="{$deal_ext.house_address}" maxlength="120" <if condition="($vo['deal_status'] neq 0 and $vo['parent_id'] neq -1) or ($pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0)">disabled title='只有 进行中或之后状态的子母标 不可以编辑'</if>/>
                </td>
            </tr>

            <tr>
                <td class="item_title">房产证编号:</td>
                <td class="item_input">
                    <input type="text" class="textbox" name="house_sn"  value="{$deal_ext.house_sn}" maxlength="120" <if condition="($vo['deal_status'] neq 0 and $vo['parent_id'] neq -1) or ($pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0)">disabled title='只有 进行中或之后状态的子母标 不可以编辑'</if>/>
                </td>
            </tr>

            <tr>
                <td class="item_title">年化基本利率:</td>
                <td class="item_input">
                    <input type="text" class="textbox require" SIZE="8" name="income_base_rate" id='income_base_rate' value="{$deal_ext.income_base_rate}" <if condition="$pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0">readonly</if>/>% <span class="tip_span"></span>
                </td>
            </tr>

            <tr>
                <td class="item_title">年化浮动利率:</td>
                <td class="item_input">
                    <input type="text" class="textbox" SIZE="8" name="income_float_rate" id='income_float_rate' value="{$deal_ext.income_float_rate}" <if condition="$pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0">readonly</if>/>% <span class="tip_span"></span>
                </td>
            </tr>

            <if condition="$vo['deal_type'] eq 0 or $vo['deal_type'] eq 2">
                <tr style="display:none;" id="bianxiantong">
                    <td class="item_title">最高预期收益:</td>
                    <td class="item_inpalign="dissplay:none;"ut">
                    <input type="text" class="textbox require" value="{$deal_ext.max_rate}" SIZE="8" name="max_rate" id="max_rate"/>%<!--借款综合成本（年化）<span id='yearly_rate' class="tip_span"></span>%  &nbsp;  <font color='red'>项目借款综合成本（年化）：{$vo.rate} %</font>-->
                    </td>
                </tr>
            </if>

            <tr>
                <td class="item_title">借款平台手续费:</td>
                <td class="item_input">
                    <input type="text" class="textbox" SIZE="8" name="loan_fee_rate" id="loan_fee_rate" value="{$vo.loan_fee_rate}" onchange="javascript:get_period_rate('loan_fee_rate');" <if condition="($vo['deal_status'] neq 0 and $vo['parent_id'] neq -1) or ($pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0)">disabled title='只有 进行中或之后状态的子母标 不可以编辑'</if>/>% 期间：<span id='period_loan_fee_rate' class="tip_span"></span>%&nbsp;&nbsp;&nbsp;&nbsp;
                    <font color='red'>（借款人给p2p平台的手续费）</font>
                    <br/>
                    <if condition="$vo['deal_status'] elt 2">
                        <label><input type="radio" name="loan_fee_rate_type" id="loan_fee_type_1" value="1" onchange="chg_loan_fee();" onclick="cli_loan_fee(this);" <if condition="$deal_ext.loan_fee_rate_type lt 2">checked="checked"</if> <if condition="($vo['is_has_loans'] eq 1) or ($pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0)">disabled="disabled"</if> />借款发放时收取（年化）</label>
                        <label><input type="radio" name="loan_fee_rate_type" id="loan_fee_type_2" value="2" onchange="chg_loan_fee();" onclick="cli_loan_fee(this);" <if condition="$deal_ext.loan_fee_rate_type eq 2">checked="checked"</if> <if condition="($vo['is_has_loans'] eq 1) or ($pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0)">disabled="disabled"</if> />还款时收取（年化）</label>
                        <label><input type="radio" name="loan_fee_rate_type" id="loan_fee_type_3" value="3" onchange="chg_loan_fee();" onclick="cli_loan_fee(this);" <if condition="$deal_ext.loan_fee_rate_type eq 3">checked="checked"</if> <if condition="($vo['is_has_loans'] eq 1) or ($pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0)">disabled="disabled"</if> />分期收取（年化）</label>
                        <label><input type="radio" name="loan_fee_rate_type" id="loan_fee_type_4" value="4" onchange="chg_loan_fee();" onclick="cli_loan_fee(this);" <if condition="$deal_ext.loan_fee_rate_type eq 4">checked="checked"</if> <if condition="($vo['is_has_loans'] eq 1) or ($pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0)">disabled="disabled"</if> />代销分期</label>
                        <label><input type="radio" name="loan_fee_rate_type" id="loan_fee_type_5" value="5" onchange="chg_loan_fee();" onclick="cli_loan_fee(this);" <if condition="$deal_ext.loan_fee_rate_type eq 5">checked="checked"</if> <if condition="($vo['is_has_loans'] eq 1) or ($pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0)">disabled="disabled"</if> />借款发放时收取（固定比例）</label>
                        <label><input type="radio" name="loan_fee_rate_type" id="loan_fee_type_6" value="6" onchange="chg_loan_fee();" onclick="cli_loan_fee(this);" <if condition="$deal_ext.loan_fee_rate_type eq 6">checked="checked"</if> <if condition="($vo['is_has_loans'] eq 1) or ($pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0)">disabled="disabled"</if> />还款时收取（固定比例）</label>
                        <label style="display:none"><input type="radio" name="loan_fee_rate_type" id="loan_fee_type_7" value="7" onchange="chg_loan_fee();" onclick="cli_loan_fee(this);" <if condition="$deal_ext.loan_fee_rate_type eq 7">checked="checked"</if> <if condition="($vo['is_has_loans'] eq 1) or ($pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0)">disabled="disabled"</if>/>固定比例分期收</label>
                    </if>
                </td>
            </tr>

            <tr id="loan_fee_custom" >
            <td class="item_title">平台手续费自定义:</td>
            <td class="item_input" id="loan_fee_custom_input"></td>
            </tr>

            <tr>
                <td class="item_title">平台费折扣率:</td>
                <td class="item_input">
                  <if condition="(in_array($vo['deal_status'], array(0,1)))">
                    <if condition="($deal_ext.discount_rate elt 100) AND ($deal_ext.discount_rate egt 0)">
                      <input type="text" class="textbox" SIZE="8"  name="discount_rate" id='discount_rate' value="{$deal_ext.discount_rate}" onchange="changeDiscountRate()" />%<span class="tip_span"></span>
                    <else />
                      <input type="text" class="textbox" SIZE="8"  name="discount_rate" style="color:red"  id='discount_rate' value="{$deal_ext.discount_rate}" onchange="changeDiscountRate()" />%<span class="tip_span"></span>
                    </if>
                  <else />
                    <if condition="($deal_ext.discount_rate elt 100) AND ($deal_ext.discount_rate egt 0)">
                      <input type="text" class="textbox" SIZE="8"  name="discount_rate"  value="{$deal_ext.discount_rate}" readonly />%<span class="tip_span"></span>
                    <else />
                      <input type="text" class="textbox" SIZE="8"  name="discount_rate" style="color:red"  value="{$deal_ext.discount_rate}" readonly />%<span class="tip_span"></span>
                    </if>
                  </if>
                </td>
            </tr>

            <tr>
                <td class="item_title">年化借款咨询费:</td>
                <td class="item_input">
                    <input type="text" class="textbox" SIZE="8" name="consult_fee_rate" id="consult_fee_rate" value="{$vo.consult_fee_rate}" onchange="javascript:get_period_rate('consult_fee_rate');"  <if condition="($vo['deal_status'] neq 0 and $vo['parent_id'] neq -1) or ($pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0)">disabled title='只有 进行中或之后状态的子母标 不可以编辑'</if>/>% 期间：<span id='period_consult_fee_rate' class="tip_span"></span>%&nbsp;&nbsp;&nbsp;&nbsp;
                    <font color='red'>（借款人给咨询机构的咨询费）</font><if condition="$vo['consult_fee_period_rate'] gt 0">分期咨询费率 {$vo.consult_fee_period_rate}%,每期收取分期咨询费{$consult_fee_period}</if>
                    <br/>
                    <if condition="$vo['deal_status'] elt 2">
                        <label><input type="radio" name="consult_fee_rate_type" id="consult_fee_type" value="1" onchange="chg_consult_fee();" <if condition="$deal_ext.consult_fee_rate_type lt 2">checked="checked"</if> <if condition="($vo['is_has_loans'] eq 1) or ($pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0)">disabled="disabled"</if> />借款发放时收取</label>
                        <label><input type="radio" name="consult_fee_rate_type" id="consult_fee_type" value="2" onchange="chg_consult_fee();" <if condition="$deal_ext.consult_fee_rate_type eq 2">checked="checked"</if> <if condition="($vo['is_has_loans'] eq 1) or ($pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0)">disabled="disabled"</if> />还款时收取</label>
                        <label><input type="radio" name="consult_fee_rate_type" id="consult_fee_type" value="3" onchange="chg_consult_fee();" onclick="calc_fenqi_fee('consult_fee');" <if condition="$deal_ext.consult_fee_rate_type eq 3">checked="checked"</if> <if condition="($vo['is_has_loans'] eq 1) or ($pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0)">disabled="disabled"</if> />分期收取</label>
                    </if>
                </td>
            </tr>

            <tr id="consult_fee_custom" <if condition="$deal_ext.consult_fee_ext eq ''">style="display:none"</if>>
            <td class="item_title">借款咨询费自定义:</td>
            <td class="item_input">
                &nbsp;&nbsp;&nbsp;&nbsp;应收金额：<span id="consult_fee">{$consult_fee}</span>&nbsp;&nbsp;&nbsp;&nbsp;应收比例：100% <br/><br/>
                <table class="form" cellpadding=0 cellspacing=0>
                    <tr>
                        <td width="100px">期次</td><td width="150px">金额(元)</td><td>比例</td>
                    </tr>
                    <if condition="$deal_ext.consult_fee_ext eq ''">
                        <tr>
                            <td>0 (起息日)</td><td><input type='text' name='consult_fee_arr[0]' class='consult_fee_arr' id='consult_fee_arr[]' value='{$consult_fee}' /></td><td class='consult_p'>100%</td>
                        </tr>
                        <php>
                            for ($i=1;$i<=$repay_times;$i++) {
                            echo "<tr><td>".$i."</td><td><input type='text' class='consult_fee_arr' name='consult_fee_arr[".$i."]' id='consult_fee_arr[]' value='0.00' /></td><td class='consult_p'>0%</td></tr>";
                            }
                        </php>
                        <else/>
                        <php>
                            $consult_fee_arr = json_decode($deal_ext['consult_fee_ext'], true);
                            foreach ($consult_fee_arr as $kk => $vv) {
                            if ($kk == 0) {
                            echo "<tr><td>0 (起息日)</td>";
                            } else {
                            echo "<tr><td>".$kk."</td>";
                            }
                            echo "<td><input type='text' class='consult_fee_arr' name='consult_fee_arr[".$kk."]' id='consult_fee_arr[]' value='".$vv."' /></td><td class='consult_p'>0%</td></tr>";
                            }
                        </php>
                    </if>
                    <tr>
                        <td>总计</td><td><span id="total_consult_fee">{$consult_fee}</span></td><td id="total_consult_p">100%</td>
                    </tr>
                </table>
            </td>
            </tr>

            <tr>
                <td class="item_title">年化借款担保费:</td>
                <td class="item_input">
                    <input type="text" class="textbox" SIZE="8" name="guarantee_fee_rate" id="guarantee_fee_rate" value="{$vo.guarantee_fee_rate}" onchange="javascript:get_period_rate('guarantee_fee_rate');"  <if condition="($vo['deal_status'] neq 0 and $vo['parent_id'] neq -1) or ($pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0)">disabled title='只有 进行中或之后状态的子母标 不可以编辑'</if>/>% 期间：<span id='period_guarantee_fee_rate' class="tip_span"></span>%&nbsp;&nbsp;&nbsp;&nbsp;
                    <font color='red'>（借款人给担保机构的担保费）</font>
                    <br/>
                    <if condition="$vo['deal_status'] elt 2">
                        <label><input type="radio" name="guarantee_fee_rate_type" id="guarantee_fee_type" value="1" onchange="chg_guarantee_fee();" <if condition="$deal_ext.guarantee_fee_rate_type lt 2">checked="checked"</if> <if condition="($vo['is_has_loans'] eq 1) or ($pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0)">disabled="disabled"</if> />借款发放时收取</label>
                        <label><input type="radio" name="guarantee_fee_rate_type" id="guarantee_fee_type" value="2" onchange="chg_guarantee_fee();" <if condition="$deal_ext.guarantee_fee_rate_type eq 2">checked="checked"</if> <if condition="($vo['is_has_loans'] eq 1) or ($pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0)">disabled="disabled"</if> />还款时收取</label>
                        <label><input type="radio" name="guarantee_fee_rate_type" id="guarantee_fee_type" value="3" onchange="chg_guarantee_fee();" onclick="calc_fenqi_fee('guarantee_fee');" <if condition="$deal_ext.guarantee_fee_rate_type eq 3">checked="checked"</if> <if condition="($vo['is_has_loans'] eq 1) or ($pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0)">disabled="disabled"</if> />分期收取</label>
                    </if>
                </td>
            </tr>

            <tr id="guarantee_fee_custom" <if condition="$deal_ext.guarantee_fee_ext eq ''">style="display:none"</if>>
            <td class="item_title">借款担保费自定义:</td>
            <td class="item_input">
                &nbsp;&nbsp;&nbsp;&nbsp;应收金额：<span id="guarantee_fee">{$guarantee_fee}</span>&nbsp;&nbsp;&nbsp;&nbsp;应收比例：100% <br/><br/>
                <table class="form" cellpadding=0 cellspacing=0>
                    <tr>
                        <td width="100px">期次</td><td width="150px">金额(元)</td><td>比例</td>
                    </tr>
                    <if condition="$deal_ext.guarantee_fee_ext eq ''">
                        <tr>
                            <td>0 (起息日)</td><td><input type='text' name='guarantee_fee_arr[0]' class='guarantee_fee_arr' id='guarantee_fee_arr[]' value='{$guarantee_fee}' /></td><td class='guarantee_p'>100%</td>
                        </tr>
                        <php>
                            for ($i=1;$i<=$repay_times;$i++) {
                            echo "<tr><td>".$i."</td><td><input type='text' class='guarantee_fee_arr' name='guarantee_fee_arr[".$i."]' id='guarantee_fee_arr[]' value='0.00' /></td><td class='guarantee_p'>0%</td></tr>";
                            }
                        </php>
                        <else/>
                        <php>
                            $guarantee_fee_arr = json_decode($deal_ext['guarantee_fee_ext'], true);
                            foreach ($guarantee_fee_arr as $kk => $vv) {
                            if ($kk == 0) {
                            echo "<tr><td>0 (起息日)</td>";
                            } else {
                            echo "<tr><td>".$kk."</td>";
                            }
                            echo "<td><input type='text' class='guarantee_fee_arr' name='guarantee_fee_arr[".$kk."]' id='guarantee_fee_arr[]' value='".$vv."' /></td><td class='guarantee_p'>0%</td></tr>";
                            }
                        </php>
                    </if>
                    <tr>
                        <td>总计</td><td><span id="total_guarantee_fee">{$guarantee_fee}</span></td><td id="total_guarantee_p">100%</td>
                    </tr>
                </table>
            </td>
            </tr>


            <tr id="canal_fee_info" <if condition="$vo.canal_agency_id eq 0 or $vo.canal_agency_id eq ''">style="display:none"</if>>
                <td class="item_title">年化借款渠道费:</td>
                <td class="item_input">
                    <input type="text" class="textbox" SIZE="8" name="canal_fee_rate" id="canal_fee_rate" value="{$vo.canal_fee_rate}" onchange="javascript:get_period_rate('canal_fee_rate');"  <if condition="($vo['deal_status'] neq 0 and $vo['parent_id'] neq -1) or ($pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0)">disabled title='只有 进行中或之后状态的子母标 不可以编辑'</if>/>% 期间：<span id='period_canal_fee_rate' class="tip_span"></span>%&nbsp;&nbsp;&nbsp;&nbsp;
                    <font color='red'>（借款人给渠道机构的渠道费）</font>
                    <br/>
                    <if condition="$vo['deal_status'] elt 2">
                        <label><input type="radio" name="canal_fee_rate_type" id="canal_fee_type" value="1" onchange="chg_canal_fee();" <if condition="$deal_ext.canal_fee_rate_type lt 2">checked="checked"</if> <if condition="($vo['is_has_loans'] eq 1) or ($pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0)">disabled="disabled"</if> />前收</label>
                        <label><input type="radio" name="canal_fee_rate_type" id="canal_fee_type" value="2" onchange="chg_canal_fee();" <if condition="$deal_ext.canal_fee_rate_type eq 2">checked="checked"</if> <if condition="($vo['is_has_loans'] eq 1) or ($pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0)">disabled="disabled"</if> />后收</label>
                        <label><input type="radio" name="canal_fee_rate_type" id="canal_fee_type" value="3" onchange="chg_canal_fee();" onclick="calc_fenqi_fee('canal_fee');" <if condition="$deal_ext.canal_fee_rate_type eq 3">checked="checked"</if> <if condition="($vo['is_has_loans'] eq 1) or ($pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0)">disabled="disabled"</if> />分期收</label>
                    </if>
                </td>
            </tr>

            <tr id="canal_fee_custom" <if condition="$deal_ext.canal_fee_ext eq ''">style="display:none"</if>>
            <td class="item_title">借款渠道费自定义:</td>
            <td class="item_input">
                &nbsp;&nbsp;&nbsp;&nbsp;应收金额：<span id="canal_fee">{$canal_fee}</span>&nbsp;&nbsp;&nbsp;&nbsp;应收比例：100% <br/><br/>
                <table class="form" cellpadding=0 cellspacing=0>
                    <tr>
                        <td width="100px">期次</td><td width="150px">金额(元)</td><td>比例</td>
                    </tr>
                    <if condition="$deal_ext.canal_fee_ext eq ''">
                        <tr>
                            <td>0 (起息日)</td><td><input type='text' name='canal_fee_arr[0]' class='canal_fee_arr' id='canal_fee_arr[]' value='{$canal_fee}' /></td><td class='canal_p'>100%</td>
                        </tr>
                        <php>
                            for ($i=1;$i<=$repay_times;$i++) {
                            echo "<tr><td>".$i."</td><td><input type='text' class='canal_fee_arr' name='canal_fee_arr[".$i."]' id='canal_fee_arr[]' value='0.00' /></td><td class='canal_p'>0%</td></tr>";
                            }
                        </php>
                        <else/>
                        <php>
                            $canal_fee_arr = json_decode($deal_ext['canal_fee_ext'], true);
                            foreach ($canal_fee_arr as $kk => $vv) {
                            if ($kk == 0) {
                            echo "<tr><td>0 (起息日)</td>";
                            } else {
                            echo "<tr><td>".$kk."</td>";
                            }
                            echo "<td><input type='text' class='canal_fee_arr' name='canal_fee_arr[".$kk."]' id='canal_fee_arr[]' value='".$vv."' /></td><td class='canal_p'>0%</td></tr>";
                            }
                        </php>
                    </if>
                    <tr>
                        <td>总计</td><td><span id="total_canal_fee">{$canal_fee}</span></td><td id="total_canal_p">100%</td>
                    </tr>
                </table>
            </td>
            </tr>

            <tr>
                <td class="item_title">年化支付服务费:</td>
                <td class="item_input">
                    <input type="text" class="textbox" SIZE="8" name="pay_fee_rate" id="pay_fee_rate" value="{$vo.pay_fee_rate}" onchange="javascript:get_period_rate('pay_fee_rate');"  <if condition="($vo['deal_status'] neq 0 and $vo['parent_id'] neq -1) or ($pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0)">disabled title='只有 进行中或之后状态的子母标 不可以编辑'</if>/>% 期间：<span id='period_pay_fee_rate' class="tip_span"></span>%&nbsp;&nbsp;&nbsp;&nbsp;
                    <font color='red'>（年化支付服务费）</font>
                    <br/>
                    <if condition="$vo['deal_status'] elt 2">
                        <label><input type="radio" name="pay_fee_rate_type" id="pay_fee_type" value="1" onchange="chg_pay_fee();" <if condition="$deal_ext.pay_fee_rate_type lt 2">checked="checked"</if> <if condition="($vo['is_has_loans'] eq 1) or ($pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0)">disabled="disabled"</if> />借款发放时收取</label>
                        <label><input type="radio" name="pay_fee_rate_type" id="pay_fee_type" value="2" onchange="chg_pay_fee();" <if condition="$deal_ext.pay_fee_rate_type eq 2">checked="checked"</if> <if condition="($vo['is_has_loans'] eq 1) or ($pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0)">disabled="disabled"</if> />还款时收取</label>
                        <label><input type="radio" name="pay_fee_rate_type" id="pay_fee_type" value="3" onchange="chg_pay_fee();" onclick="calc_fenqi_fee('pay_fee');" <if condition="$deal_ext.pay_fee_rate_type eq 3">checked="checked"</if> <if condition="($vo['is_has_loans'] eq 1) or ($pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0)">disabled="disabled"</if> />分期收取</label>
                    </if>
                </td>
            </tr>

            <tr id="pay_fee_custom" <if condition="$deal_ext.pay_fee_ext eq ''">style="display:none"</if>>
            <td class="item_title">年化支付服务费自定义:</td>
            <td class="item_input">
                &nbsp;&nbsp;&nbsp;&nbsp;应收金额：<span id="pay_fee">{$pay_fee}</span>&nbsp;&nbsp;&nbsp;&nbsp;应收比例：100% <br/><br/>
                <table class="form" cellpadding=0 cellspacing=0>
                    <tr>
                        <td width="100px">期次</td><td width="150px">金额(元)</td><td>比例</td>
                    </tr>
                    <if condition="$deal_ext.pay_fee_ext eq ''">
                        <tr>
                            <td>0 (起息日)</td><td><input type='text' name='pay_fee_arr[0]' class='pay_fee_arr' id='pay_fee_arr[]' value='{$pay_fee}' /></td><td class='pay_p'>100%</td>
                        </tr>
                        <php>
                            for ($i=1;$i<=$repay_times;$i++) {
                            echo "<tr><td>".$i."</td><td><input type='text' class='pay_fee_arr' name='pay_fee_arr[".$i."]' id='pay_fee_arr[]' value='0.00' /></td><td class='pay_p'>0%</td></tr>";
                            }
                        </php>
                        <else/>
                        <php>
                            $pay_fee_arr = json_decode($deal_ext['pay_fee_ext'], true);
                            foreach ($pay_fee_arr as $kk => $vv) {
                            if ($kk == 0) {
                            echo "<tr><td>0 (起息日)</td>";
                            } else {
                            echo "<tr><td>".$kk."</td>";
                            }
                            echo "<td><input type='text' class='pay_fee_arr' name='pay_fee_arr[".$kk."]' id='pay_fee_arr[]' value='".$vv."' /></td><td class='pay_p'>0%</td></tr>";
                            }
                        </php>
                    </if>
                    <tr>
                        <td>总计</td><td><span id="total_pay_fee">{$pay_fee}</span></td><td id="total_pay_p">100%</td>
                    </tr>
                </table>
            </td>
            </tr>

            <tr id="management_fee_rate_tr" style="display:none">
                <td class="item_title">年化管理服务费:</td>
                <td class="item_input">
                    <input type="text" class="textbox" SIZE="8" name="management_fee_rate" id="management_fee_rate" value="{$vo.management_fee_rate}" onchange="javascript:get_period_rate('management_fee_rate');"  <if condition="($vo['deal_status'] neq 0 and $vo['parent_id'] neq -1) or ($pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0)">disabled title='只有 进行中或之后状态的子母标 不可以编辑'</if>/>% 期间：<span id='period_management_fee_rate' class="tip_span"></span>%&nbsp;&nbsp;&nbsp;&nbsp;
                    <font color='red'>（年化管理服务费）</font>
                    <br/>
                    <if condition="$vo['deal_status'] elt 2">
                        <label><input type="radio" name="management_fee_rate_type" id="management_fee_type" value="1" onchange="chg_management_fee();" <if condition="$deal_ext.management_fee_rate_type lt 2">checked="checked"</if> <if condition="($vo['is_has_loans'] eq 1) or ($pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0)">disabled="disabled"</if> />前收</label>
                        <label><input type="radio" name="management_fee_rate_type" id="management_fee_type" value="2" onchange="chg_management_fee();" <if condition="$deal_ext.management_fee_rate_type eq 2">checked="checked"</if> <if condition="($vo['is_has_loans'] eq 1) or ($pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0)">disabled="disabled"</if> />后收</label>
                        <label><input type="radio" name="management_fee_rate_type" id="management_fee_type" value="3" onchange="chg_management_fee();" onclick="calc_fenqi_fee('management_fee');" <if condition="$deal_ext.management_fee_rate_type eq 3">checked="checked"</if> <if condition="($vo['is_has_loans'] eq 1) or ($pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0)">disabled="disabled"</if> />分期收</label>
                    </if>
                </td>
            </tr>

            <tr id="management_fee_custom" <if condition="$deal_ext.management_fee_ext eq ''">style="display:none"</if>>
            <td class="item_title">年化管理服务费自定义:</td>
            <td class="item_input">
                &nbsp;&nbsp;&nbsp;&nbsp;应收金额：<span id="management_fee">{$management_fee}</span>&nbsp;&nbsp;&nbsp;&nbsp;应收比例：100% <br/><br/>
                <table class="form" cellpadding=0 cellspacing=0>
                    <tr>
                        <td width="100px">期次</td><td width="150px">金额(元)</td><td>比例</td>
                    </tr>
                    <if condition="$deal_ext.management_fee_ext eq ''">
                        <tr>
                            <td>0 (起息日)</td><td><input type='text' name='management_fee_arr[0]' class='management_fee_arr' id='management_fee_arr[]' value='{$management_fee}' /></td><td class='management_p'>100%</td>
                        </tr>
                        <php>
                            for ($i=1;$i<=$repay_times;$i++) {
                            echo "<tr><td>".$i."</td><td><input type='text' class='management_fee_arr' name='management_fee_arr[".$i."]' id='management_fee_arr[]' value='0.00' /></td><td class='management_p'>0%</td></tr>";
                            }
                        </php>
                        <else/>
                        <php>
                            $management_fee_arr = json_decode($deal_ext['management_fee_ext'], true);
                            foreach ($management_fee_arr as $kk => $vv) {
                            if ($kk == 0) {
                            echo "<tr><td>0 (起息日)</td>";
                            } else {
                            echo "<tr><td>".$kk."</td>";
                            }
                            echo "<td><input type='text' class='management_fee_arr' name='management_fee_arr[".$kk."]' id='management_fee_arr[]' value='".$vv."' /></td><td class='management_p'>0%</td></tr>";
                            }
                        </php>
                    </if>
                    <tr>
                        <td>总计</td><td><span id="total_management_fee">{$management_fee}</span></td><td id="total_management_p">100%</td>
                    </tr>
                </table>
            </td>
            </tr>

            <tr style="display:none">
                <td class="item_title">年化出借人平台管理费:</td>
                <td class="item_input">
                    <input type="text" class="textbox" SIZE="8" onchange="javascript:changeRate('annualized_rate');" name="manage_fee_rate" id="manage_fee_rate" class="changepmt" value="{$vo.manage_fee_rate}"  <if condition="($vo['publish_wait'] eq 0 and $vo['parent_id'] neq -1) or ($pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0)">disabled title='只有审核之后的子母标不可以编辑'</if>/>%
                    <input type="text" class="textbox" SIZE="50" name="manage_fee_text" value="{$vo.manage_fee_text}" <if condition="($vo['deal_status'] neq 0 and $vo['parent_id'] neq -1) or ($pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0)">disabled title='只有 进行中或之后状态的子母标 不可以编辑'</if>>
                </td>
            </tr>


            <tr style="display:none">
                <td class="item_title">年化收益平台补贴利率:</td>
                <td class="item_input">
                    <input type="text" class="textbox" SIZE="10" name="income_subsidy_rate" id='income_subsidy_rate' value="{$deal_ext.income_subsidy_rate}" <if condition="$pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0">disabled</if>/>% <span class="tip_span"></span>
                </td>
            </tr>

            <tr style="display:none">
                <td class="item_title">年化顾问利率:</td>
                <td class="item_input">
                    <input type="text" class="textbox" SIZE="8" name="advisor_fee_rate" id='advisor_fee_rate' value="0" onchange="javascript:get_period_rate('advisor_fee_rate');" <if condition="($vo['publish_wait'] eq 0 and $vo['parent_id'] neq -1) or ($pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0)">disabled title='只有审核之后的子母标不可以编辑'</if>/>% 期间：<span id='period_advisor_fee_rate' class="tip_span"></span>%
                </td>
            </tr>

            <tr>
                <td class="item_title">借款年利率:</td>
                <td class="item_input">
                    <if condition="$vo['deal_type'] eq 1">
                        <input type="text" class="textbox" style="border: 1px solid #DDD;background-color: #F5F5F5;" readonly value="{$vo['rate']}" onchange="javascript:changeRate('income_fee_rate');" SIZE="8" name="rate" id="annualized_rate"/>% &nbsp;  <font color='red' id ="day_rate">日利率：{$vo.rate_day} </font>%
                        <else />
                        <input type="text" class="textbox" style="border: 1px solid #DDD;background-color: #F5F5F5;" readonly SIZE="8" onchange="javascript:changeRate('income_fee_rate');" name="rate" value="{$vo.rate}"  id="annualized_rate" <if condition="($vo['publish_wait'] eq 0 and $vo['parent_id'] neq -1)">disabled title='只有审核之后的子母标不可以编辑'</if>/>%
                        <!--借款综合成本（年化）：<span id='yearly_rate' class="tip_span"></span>%  &nbsp; <if condition="$pro['id']"><font color='red'>项目借款综合成本（年化）：{$pro.rate} %</font>--></if>
                    </if>

                </td>
            </tr>

            <tr>
                <td class="item_title">年化出借人利率:</td>
                <td class="item_input">
                    <input type="text" class="textbox" readonly style="border: 1px solid #DDD;background-color: #F5F5F5;" SIZE="8" onchange="javascript:changeRate('annualized_rate');" name="income_fee_rate" id='income_fee_rate' value="{$vo.income_fee_rate}" <if condition="$pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0">readonly</if>/>%
                </td>
            </tr>

            <tr>
                <td class="item_title">提前还款违约金系数:</td>
                <td class="item_input">
                    <input type="text" class="textbox" SIZE="8" name="prepay_rate" id='prepay_rate' value="{$vo.prepay_rate}" <if condition="$pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0">readonly</if>/>%<span class="tip_span"></span>
                </td>
            </tr>
            <tr>
                <td class="item_title">提前还款罚息天数:</td>
                <td class="item_input">
                    <input type="text" class="textbox" SIZE="8" name="prepay_penalty_days" id='prepay_penalty_days' value="{$vo.prepay_penalty_days}" <if condition="$pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0">readonly</if>/><span class="tip_span"></span>
                </td>
            </tr>
            <tr>
                <td class="item_title">提前还款/回购限制:</td>
                <td class="item_input">
                    <input type="text" class="textbox require" SIZE="8" name="prepay_days_limit" id='prepay_days_limit' value="{$vo.prepay_days_limit}" <if condition="$pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0">readonly</if>/><span class="tip_span">天之内，不可提前还款</span>
                </td>
            </tr>
            <tr>
                <td class="item_title">逾期还款罚息系数:</td>
                <td class="item_input">
                    <input type="text" class="textbox" SIZE="8" name="overdue_rate" id='overdue_rate' value="{$vo.overdue_rate}" <if condition="$pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0">readonly</if>/>%
                </td>
            </tr>
            <tr>
                <td class="item_title">代偿时间:</td>
                <td class="item_input">
                    <input type="text" class="textbox" SIZE="8" name="overdue_day" id='overdue_day' value="{$vo.overdue_day}" <if condition="$pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0">readonly</if>/>天之后，代偿应还本金和逾期罚息(从应还款之日起算)
                </td>
            </tr>
            <tr>
                <td class="item_title">合同类型</td>
                <td class="item_input">
                    <select id="contract_tpl_type" name="contract_tpl_type" <if condition="($vo['deal_status'] neq 0 and $vo['parent_id'] neq -1) or ($pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0)">disabled title='只有 进行中或之后状态的子母标 不可以编辑'</if>>
                    <foreach name="contract_tpl_type" key='t_key' item="t_item">
                        <option value="{$t_item.id}" <if condition="$t_item.id eq $vo['contract_tpl_type']">selected="selected"</if>>{$t_item.typeName}</option>
                    </foreach>
                    <option value="" <if condition="$vo['contract_tpl_type'] eq ''">selected="selected" </if>>没有合同</option>
                    </select>
                </td>
            </tr>

            <tr>
                <td class="item_title">基础合同的编号</td>
                <td class="item_input">
                    <input type="text" class="textbox" name="leasing_contract_num"  value="{$deal_ext.leasing_contract_num}" maxlength="120" <if condition="$pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0">readonly</if>/>
                </td>
            </tr>

            <tr>
                <td class="item_title">转让资产类别</td>
                <td class="item_input">
                    <select id="contract_transfer_type"  name="contract_transfer_type" <if condition="$pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0">disabled</if>>
                        <option value="0" <if condition="$deal_ext.contract_transfer_type eq 0">selected="selected"</if>>无</option>
                        <option value="1"  <if condition="$deal_ext.contract_transfer_type eq 1">selected="selected"</if>>债权</option>
                        <option value="2" <if condition="$deal_ext.contract_transfer_type eq 2">selected="selected"</if>>资产收益权</option>
                    </select>
                    <font color='red'>（债权转让合同显示专用）</font>
                </td>
            </tr>

            <tr>
                <td class="item_title">原始债务人</td>
                <td class="item_input">
                    <input type="text" class="textbox" name="lessee_real_name"  value="{$deal_ext.lessee_real_name}" maxlength="120" size="100" <if condition="$pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0">readonly</if>/>
                </td>
            </tr>

            <tr>
                <td class="item_title">基础合同交易金额</td>
                <td class="item_input">
                    <input type="text" class="textbox" name="leasing_money"  value="{$deal_ext.leasing_money}" maxlength="120" <if condition="$pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0">readonly</if>/>元
                </td>
            </tr>

            <tr>
                <td class="item_title">基础合同名称</td>
                <td class="item_input">
                    <input type="text" class="textbox" name="leasing_contract_title"  value="{$deal_ext.leasing_contract_title}" maxlength="120" <if condition="$pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0">readonly</if>/>
                </td>
            </tr>

            <tr>
                <td class="item_title">委托贷款委托合同的编号</td>
                <td class="item_input">
                    <input type="text" class="textbox" name="entrusted_loan_entrusted_contract_num"  value="{$deal_ext.entrusted_loan_entrusted_contract_num}" maxlength="120" <if condition="$pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0">readonly</if>/>
                </td>
            </tr>

            <tr>
                <td class="item_title">委托贷款借款合同的编号</td>
                <td class="item_input">
                    <input type="text" class="textbox" name="entrusted_loan_borrow_contract_num"  value="{$deal_ext.entrusted_loan_borrow_contract_num}" maxlength="120" <if condition="$pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0">readonly</if>/>
                </td>
            </tr>



            <tr>
                <td class="item_title">基础合同的借款到期日:</td>
                <td class="item_input">
                    <input type="text" class="textbox" name="base_contract_repay_time" id="base_contract_repay_time" value="{$deal_ext.base_contract_repay_time}" onfocus="this.blur(); return showCalendar('base_contract_repay_time', '%Y-%m-%d', false, false, 'btn_base_contract_repay_time');" <if condition="$pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0">readonly</if> />
                    <input type="button" class="button" id="btn_base_contract_repay_time" value="选择时间" onclick="return showCalendar('base_contract_repay_time', '%Y-%m-%d', false, false, 'btn_base_contract_repay_time');" <if condition="$pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0">readonly</if> />
                    <input type="button" class="button" value="清空时间" onclick="$('#base_contract_repay_time').val('');" <if condition="$pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0">readonly</if> />
                </td>
            </tr>



            <tr>
                <td class="item_title">中途逾期强还天数</td>
                <td class="item_input">
                    <input type="text" class="textbox require" name="overdue_break_days"  value="{$deal_ext.overdue_break_days}" maxlength="120" <if condition="$pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0">readonly</if>/>天<span class="tip_span">（逾期还款T日以上，视为借款人违约，出借人有权提前解除合同）</span>
                </td>
            </tr>

            <tr style="display:none">
                <td class="item_title">提前还款年化出借人平台管理费</td>
                <td class="item_input">
                    <input type="text" class="textbox" name="prepay_manage_fee_rate"  value="{$deal_ext.prepay_manage_fee_rate}" maxlength="120" <if condition="$pro['business_status'] neq $project_business_status['waitting'] and $vo['deal_status'] neq 0">readonly</if>/>%
                </td>
            </tr>

            <tr style="display:none">
                <td class="item_title">{%DEAL_DESCRIPTION}:</td>
                <td class="item_input">
                    <html:editor id="description" name="description" style="width:500px;height:100px" content="{$vo.description}" />
                </td>
            </tr>

            <tr>
                <td class="item_title">借款状态:</td>
                <td class="item_input">
                    <if condition="$vo['deal_status'] eq 5">已还清
                        <elseif condition="$vo['deal_status'] eq 3"/>流标
                        <else/>
                        <label>
                            <input type="radio" name="deal_status" class="deal_status" value="0" onclick="cli_deal_status(this)" <if condition="$vo['deal_status'] eq 0">checked="checked"</if> />{%DEAL_STATUS_0}
                        </label>

                        <label>
                            <input type="radio" name="deal_status" class="deal_status" value="1" onclick="cli_deal_status(this)" <if condition="$vo['deal_status'] eq 1">checked="checked"</if> />{%DEAL_STATUS_1}
                        </label>

                        <php>if ($vo['deal_status'] <> 4):</php>
                        <label>
                            <input type="radio" name="deal_status" class="deal_status" value="3" onclick="cli_deal_status(this)" <if condition="$vo['deal_status'] eq 3">checked="checked"</if> />{%DEAL_STATUS_3}
                        </label>
                        <php>endif;</php>

                        <label>
                            <input type="radio" name="deal_status" class="deal_status" value="4" onclick="cli_deal_status(this)" <if condition="$vo['deal_status'] eq 4">checked="checked"</if> />{%DEAL_STATUS_4}
                        </label>
                    </if>
                </td>
            </tr>

            <tr id="start_time_box" <if condition="$vo['deal_status'] neq 1">style="display:none"</if>>
            <td class="item_title">开始时间:</td>
            <td class="item_input">
                <input type="text" class="textbox <if condition="$vo['deal_status'] eq 1">require</if>" name="start_time" value="{$vo.start_time}" id="start_time"  onfocus="this.blur(); return showCalendar('start_time', '%Y-%m-%d %H:%M:%S', false, false, 'btn_start_time');" />
                <input type="button" class="button" id="btn_start_time" value="{%SELECT_TIME}" onclick="return showCalendar('start_time', '%Y-%m-%d %H:%M:%S', false, false, 'btn_start_time');" />
                <input type="button" class="button" value="{%CLEAR_TIME}" onclick="$('#start_time').val('');" />
            </td>
            </tr>

            <tr id="bad_time_box" <if condition="$vo['deal_status'] neq 3">style="display:none"</if>>
            <td class="item_title">{%DEAL_STATUS_3}时间:</td>
            <td class="item_input">
                <input type="text" class="textbox <if condition="$vo['deal_status'] eq 3">require</if>" name="bad_time" id="bad_time" value="{$vo.bad_time}" onfocus="this.blur(); return showCalendar('bad_time', '%Y-%m-%d %H:%M:%S', false, false, 'btn_bad_time');" />
                <input type="button" class="button" id="btn_bad_time" value="{%SELECT_TIME}" onclick="return showCalendar('bad_time', '%Y-%m-%d %H:%M:%S', false, false, 'btn_bad_time');" />
                <input type="button" class="button" value="{%CLEAR_TIME}" onclick="$('#bad_time').val('');" />
            </td>
            </tr>

            <tr id="bad_info_box" <if condition="$vo['deal_status'] neq 3">style="display:none"</if>>
            <td class="item_title">{%DEAL_STATUS_3}原因:</td>
            <td class="item_input">
                <textarea type="text" class="textbox" name="bad_msg" id="bad_msg" value="" rows="3" cols="50">{$vo.bad_msg}</textarea>
            </td>
            </tr>

            <tr id="repay_start_time_box" <if condition="$vo['deal_status'] neq 4">style="display:none"</if>>
            <td class="item_title">确认时间:</td>
            <td class="item_input">
                <input type="text" class="textbox <if condition="$vo['deal_status'] eq 4">require</if>" name="repay_start_time" id="repay_start_time" value="{$vo.repay_start_time}" onfocus="this.blur(); return showCalendar('repay_start_time', '%Y-%m-%d', false, false, 'btn_repay_start_time');" />
                <input type="button" class="button" id="btn_repay_start_time" value="{%SELECT_TIME}" onclick="return showCalendar('repay_start_time', '%Y-%m-%d', false, false, 'btn_repay_start_time');" />
                <input type="button" class="button" value="{%CLEAR_TIME}" onclick="$('#repay_start_time').val('');" />
                <br>
                <span class="tip_span">还款日从确认时间开始的下个月算起，确认时间不要设置为29,30,31号</span>
            </td>
            </tr>

            <tr id="first_repay_day_box" <if condition="($vo['loantype'] neq 8 && $vo['deal_status'] neq 4) || ($vo['loantype'] neq 8 && $vo['loantype'] neq 4 && $vo['loantype'] neq 6) ">style="display:none"</if>>
            <td class="item_title">第一期还款日:</td>
            <td class="item_input">
                <if condition="$vo['loantype'] eq 8">
                    <input id="first_repay_interest_day" type="text" class="textbox" name="first_repay_interest_day" disabled value="<if condition="$deal_ext['first_repay_interest_day'] neq 0">{$deal_ext.first_repay_interest_day}</if>"/>
                <else/>
                <input type="text" class="textbox" name="first_repay_interest_day" <if condition="$vo['deal_status'] eq 4 || $vo['deal_status'] eq 5 ">disable="true"</if> value="<if condition="$deal_ext['first_repay_interest_day'] neq 0">{$deal_ext.first_repay_interest_day}</if>" id="first_repay_interest_day"  onfocus="this.blur(); return showCalendar('first_repay_interest_day', '%Y-%m-%d', false, false, 'btn_first_repay_interest_day');" />
                <if condition="$vo['deal_status'] eq 2">
                    <input type="button" class="button" id="btn_first_repay_interest_day" value="{%SELECT_TIME}" onclick="return showCalendar('first_repay_interest_day', '%Y-%m-%d', false, false, 'btn_first_repay_interest_day');" />
                    <input type="button" class="button" value="{%CLEAR_TIME}" onclick="$('#first_repay_interest_day').val('');" />
                </if>
                </if>
            </td>
            </tr>

            <tr id='start_loan_time_box' <if condition="$vo['deal_status'] neq 0">style="display:none"</if>>
            <td class="item_title">开标时间:</td>
            <td class="item_input">
                <input type="text" class="textbox" name="start_loan_time" value="{$deal_ext.start_loan_time}" id="start_loan_time"  onfocus="this.blur(); return showCalendar('start_loan_time', '%Y-%m-%d %H:%M:00', false, false, 'btn_start_loan_time');" />
                <input type="button" class="button" id="btn_start_loan_time" value="{%SELECT_TIME}" onclick="return showCalendar('start_loan_time', '%Y-%m-%d %H:%M:00', false, false, 'btn_start_loan_time');" />
                <input type="button" class="button" value="{%CLEAR_TIME}" onclick="$('#start_loan_time').val('');" />
                <span class="tip_span" style="color:red;">（定时标适用）</span>
            </td>
            </tr>

            <tr>
                <td class="item_title">{%IS_EFFECT}:</td>
                <td class="item_input">
                    <lable><input type="radio" name="is_effect" value="1" <if condition="$vo['is_effect'] eq 1">checked="checked"</if> />{%IS_EFFECT_1}</lable>
                    <lable><input type="radio" name="is_effect" value="0" <if condition="$vo['is_effect'] eq 0">checked="checked"</if> />{%IS_EFFECT_0}</lable>
                    <!-- <span class="tip_span">您如果修改了除“借款状态”和“开始时间”之外的其他内容，该状态将保存为无效。</span> -->
                </td>
            </tr>

            <tr style="display:none">
                <td class="item_title">是否并发投资:</td>
                <td class="item_input">
                    <lable><input type="radio" name="is_bid_new" value="1" <if condition="$deal_ext['is_bid_new'] eq 1">checked="checked"</if> />是</lable>
                    <lable><input type="radio" name="is_bid_new" value="0" <if condition="$deal_ext['is_bid_new'] eq 0">checked="checked"</if> />否</lable>
                </td>
            </tr>

           <!-- <if condition="$vo['deal_type'] neq 1">
                <tr>

                    <td class="item_title">优惠码结算时间:</td>
                    <td class="item_input">
                        <label><input type="radio"  name="pay_type" class="pay_type" value="0" <if condition="$deal_coupon['pay_type'] eq 0">checked="checked"</if> <if condition="$pro['business_status'] gt $project_business_status['repaying']">readonly</if>/>放款时结算</label>
                        <label><input type="radio"  name="pay_type" class="pay_type" value="1" <if condition="$deal_coupon['pay_type'] eq 1">checked="checked"</if> <if condition="$pro['business_status'] gt $project_business_status['repaying']">readonly</if>/>还清时结算</label>
                    </td>
                </tr>
                <tr>
                    <td class="item_title">优惠码结算方式</td>
                    <td class="item_input">
                        <label><input type="radio"  name="pay_auto" value="2" <if condition="empty($deal_coupon['pay_auto']) || $deal_coupon['pay_auto'] eq 2">checked="checked"</if> <if condition="$pro['business_status'] gt $project_business_status['repaying']">readonly</if>/>手工结算</label>
                        <label><input type="radio"  name="pay_auto" value="1" <if condition="$deal_coupon['pay_auto'] eq 1">checked="checked"</if> <if condition="$pro['business_status'] gt $project_business_status['repaying']">readonly</if>/>自动结算</label>
                    </td>
                </tr>
                <tr>
                    <td class="item_title">优惠码返利天数</td>
                    <td class="item_input">
                        <input type="text" class="textbox" name="rebate_days" id="rebate_days" value="{$deal_coupon.rebate_days}" <if condition="($deal_coupon['is_paid'] eq 1) OR ($vo['deal_status'] lt 2)"> readonly="true" </if> <if condition="$pro['business_status'] gt $project_business_status['repaying']">readonly</if>/>
                        <span class="tip_span" style="color:red;">按月计算的标，返利天数=月数*30(如3个月填90天，一年填360天)。该值变更后，相应的优惠码记录的返点比例金额才会按该返利天数重新计算，但返点金额不变。</span>
                    </td>
                </tr>
                <if condition="$loan_type_info.type_tag eq $xffq_tag">
                <tr>
                    <td class="item_title">优惠码返利结算延迟时间</td>
                    <td class="item_input">
                        <input type="text" class="textbox" name="delay_days" id="delay_days" value="7" disabled="true" />
                        <span class="tip_span" style="color:red;">天后结算返利。</span>
                    </td>
                </tr>
                </if>
            </if>-->
            <tr>
                <td class="item_title">备注:</td>
                <td class="item_input">
                    <html:editor id="note" name="note" style="width:500px;height:30px" content="{$vo.note}" />
                </td>
            </tr>
            <tr <if condition="$vo['deal_type'] neq 2"> style="display:none"  </if>>
                <td class="item_title">交易所备案产品编号:</td>
                <td class="item_input">
                    <input type="text" class="textbox" name="jys_record_number" value="{$vo.jys_record_number}" />
                </td>
            </tr>
            <tr>
                <td class="item_title">放款审批单编号:</td>
                <td class="item_input">
                    <input type="text" class="textbox" name="approve_number" value="{$vo.approve_number}" />
                </td>
            </tr>

            <if condition="$vo['deal_type'] eq 0">
                <tr>
                    <td class="item_title">存管报备:</td>
                    <td class="item_input">
                        <if condition="$vo['report_status'] eq 1">
                            <span style="color:red">已经成功报备到存管行不可撤销</span>
                            <else/>
                            报备<input type="radio"  name="report_type" value="1" checked>&nbsp;
                            不报备<input type="radio" name="report_type" value="0">&nbsp;
                        </if>
                    </td>
                </tr>
            </if>

            <!-- deal muti-site start -->
            <tr>
                <td class="item_title">所属网站:</td>
                <td class="item_input">
                    <foreach name="site_list" key='site_name' item="site_id">
                        <label><input type="radio" name="deal_site[]" value="{$site_id}" <if condition="isset($deal_site_list[$site_id])">checked</if> >{$site_name}</label>
                    </foreach>
                </td>
            </tr>
            <!-- end -->

            <tr>
                <td colspan=2 class="bottomTd"></td>
            </tr>

        </table>
        <table class="form conf_tab" cellpadding=0 cellspacing=0 rel="2">
            <tr>
                <td colspan=2 class="topTd"></td>
            </tr>
            <tr>
                <td class="item_title">{%DEAL_SEO_TITLE}:</td>
                <td class="item_input"><textarea class="textarea" name="seo_title" >{$vo.seo_title}</textarea></td>
            </tr>
            <tr>
                <td class="item_title">{%DEAL_SEO_KEYWORD}:</td>
                <td class="item_input"><textarea class="textarea" name="seo_keyword" >{$vo.seo_keyword}</textarea></td>
            </tr>
            <tr>
                <td class="item_title">{%DEAL_SEO_DESCRIPTION}:</td>
                <td class="item_input"><textarea class="textarea" name="seo_description" >{$vo.seo_description}</textarea></td>
            </tr>
            <tr>
                <td colspan=2 class="bottomTd"></td>
            </tr>
        </table>
        <div class="blank5"></div>
        <table class="form" cellpadding=0 cellspacing=0>
            <tr>
                <td colspan=2 class="topTd"></td>
            </tr>
            <tr>
                <td class="item_title"></td>
                <td class="item_input">

                    <!--隐藏元素-->
                    <input type="hidden" name="id" id="deal_id" value="{$vo.id}" />
                    <input type="hidden" name="deal_ext_id" value="{$deal_ext.deal_id}" />
                    <input type="hidden" name="deal_type" id="deal_type" value="{$vo.deal_type}" />
                    <input type="hidden" name="deal_compound_id" value="{$vo['compound_id']}" />
                    <input type="hidden" name="next_repay_time" value="{$vo.next_repay_time}" />
                    <input type="hidden" id="repay_times"  value="{$repay_times}" />
                    <input type="hidden" id="repay_time"  value="{$vo.repay_time}" />
                    <input type="hidden" name="{:conf("VAR_MODULE")}" value="Deal" />
                    <input type="hidden" name="{:conf("VAR_ACTION")}" value="update" />

                    <div id='button_ff'>
                        <!--普通单-->
                        <input type="submit" onclick="return confirmSubmit();" class="button" value="{%SAVE}" />
                        <input type="reset" class="button" value="{%RESET}"/>
                    </div>
                </td>

            </tr>
            <tr>
                <td colspan=2 class="bottomTd"></td>
            </tr>
        </table>
    </form>
</div>

<script type="text/javascript" language="javascript">
    function iFrameHeight(frame_id) {
        var ifm = document.getElementById(frame_id);
        var subWeb = document.frames ? document.frames[frame_id].document : ifm.contentDocument;
        if (ifm != null && subWeb != null && subWeb.body != null) {
            //ifm.height = subWeb.body.scrollHeight;
            //ifm.height = subWeb.body.clientHeight;
            ifm.height = /chrome/gi.test(window.navigator.userAgent) ? subWeb.body.clientHeight : subWeb.body.scrollHeight;

        }
    }
</script>

<script type="text/javascript">

//    $("input[name='report_type']").click(function(){
//        if($(this).attr("checked")){
//            alert('您已经选定此标的报备到存管行 请谨慎操作！');
//        }
//    });
    //声明
    var auto_changeRate = false;
    var auto_change_loanrate = false;
    var auto_update_income_base_rate = false;
    var isP2P = false;
    var hasReportToBank = false;

    <if condition="$deal_ext['income_base_rate'] eq 0 and $deal_ext['income_float_rate'] eq 0">
    auto_update_income_base_rate = true;
    </if>

    <if condition="$vo['publish_wait'] eq 1">
    auto_changeRate = true;
    </if>

    <if condition="$vo['deal_type'] eq 0">
    isP2P = true;
    </if>

    <if condition="$vo['report_status'] eq 1">
        hasReportToBank = true;
    </if>


    $(document).ready(function(){

        chg_fee();
        //自动执行
        changeRepay();

        /* if(auto_changeRate){
         changeRate('income_fee_rate');
         } */

        change_year_to_period();

        $("#income_base_rate,#income_float_rate").change(function(){
            income_fee_rate = parseFloat($("#income_fee_rate").val()); // 年化出借人收益率
            annualized_rate = parseFloat($("#annualized_rate").val()); // 借款年利率
            income_float_rate = parseFloat($("#income_float_rate").val()); //年化收益浮动利率
            income_base_rate = parseFloat($("#income_base_rate").val()); // 年化收益基本利率

            if(isNaN(income_base_rate)) {
                income_base_rate = 0;
            }
            if(isNaN(income_float_rate)) {
                income_float_rate = 0;
            }
            total_rate = (income_float_rate + income_base_rate).toFixed(5);

            $("#income_fee_rate").val(total_rate);
            $("#annualized_rate").val(total_rate);
            get_complex_rate();

            if ($("#deal_type").val() == 1) {
                var year_rate = $("#annualized_rate").val();
                var redemption_period = $("#redemption_period").val();
                $.ajax({
                    url: ROOT + "?" + VAR_MODULE + "=DealProject&" + VAR_ACTION + "=convertRateYearToDay&rate=" + year_rate + "&redemption_period=" + redemption_period,
                    dataType: "json",
                    async: false,
                    success: function(rs) {
                        $("#day_rate").html(rs.day_rate)
                    }
                });
            }
        });
    });

    function changeRate(tag){

        if(!tag){
            return false;
        }
        var income_rate = parseFloat($('#income_fee_rate').val());
        var rate = parseFloat($('#annualized_rate').val());
        var manage_rate = parseFloat($('#manage_fee_rate').val());
        var repay_time = $("select[name='repay_time']").val();
        var loantype = $('#repay_mode').val();
        var income_base_rate = $('#income_base_rate').val();
        var income_float_rate = $('#income_float_rate').val();

        if(loantype == 5){
            repay_time = $("input[name='repay_time']").val();
        }

        /* $.get("/m.php?m=Ajax&a=getDailyRate&rate="+rate,function(dt){
         $('#rate_day').val(dt);
         }) */

        var tem_lock = false;
        $.get("/m.php?m=Ajax&a=get_fee_rate&rate="+rate+"&manage_rate="+manage_rate+"&income_rate="+income_rate+"&tag="+tag+"&repay_time="+repay_time+"&loantype="+loantype,function(dt){

            $('#'+tag).val(dt);
            tem_lock = true;

            if(auto_update_income_base_rate){
                var income_base_rate_val = dt;
                if(tag != 'income_fee_rate'){
                    income_base_rate_val = income_rate;
                }

                $('#income_base_rate').val(income_base_rate_val);
                $('#income_float_rate').val('0');
            }else{
                auto_update_income_base_rate = true;
            }

            if(tem_lock == true){
                get_complex_rate();
                change_year_to_period();
            }
            var year_rate = $("#annualized_rate").val();
            // 修改日利率
            if ($("#deal_type").val() == 1) {
                var redemption_period = $("#redemption_period").val();
                $.ajax({
                    url: ROOT + "?" + VAR_MODULE + "=DealProject&" + VAR_ACTION + "=convertRateYearToDay&rate=" + year_rate + "&redemption_period=" + redemption_period,
                    dataType: "json",
                    async: false,
                    success: function(rs) {
                        $("#day_rate").html(rs.day_rate)
                    }
                });
            }
        })

    }

    function changeLoantype() {
        var loantype = $("#repay_mode").val();
        var deal_status = $("input[name='deal_status']:checked").val();
        if((((loantype == 4 || loantype == 6) && deal_status == 4) || loantype == 8)) {
            $("#first_repay_day_box").show();
        } else {
            $("#first_repay_day_box").hide();
        }
    }

    function changeRepay(tag){
        var repay_mode = $('#repay_mode').val();
        changeRepay.is_index_rebate_days = changeRepay.is_index_rebate_days || 0;
    <if condition="$vo['deal_type'] neq 1">
        // 自动填写返利天数
            if (repay_mode !=5){
                var repay_period_v = $("#repay_period3").val();
                switch(repay_mode){
                    case '1':
                    case '6':
                    case '7':
                        repay_period_v = $("#repay_period").val();
                        break;
                    case '8': //固定日还款特殊算法
                        repay_period_v = $("#repay_period3").val();
                        break;
                }

                $("#rebate_days").val(repay_period_v*30);
            }else if (repay_mode == 5){
                repay_period_v = $("#repay_period2").val();
                $("#rebate_days").val(repay_period_v);
            }
    <if condition="isset($deal_coupon['rebate_days'])">
            if (changeRepay.is_index_rebate_days == 0){
                $("#rebate_days").val({$deal_coupon['rebate_days']});
            }

        changeRepay.is_index_rebate_days++;
    </if>
    </if>
        changeLoantype();

        //切换html
        if(repay_mode == 5){
            $('.xhsoi').hide();
            $('.xhsot').show();

            var repay_period = $('#repay_period2').val();
            $('#repay_period').hide();
            $('#repay_period').removeAttr('name');
            $('#repay_period2,#tian').show();
            $('#repay_period2').attr('name', 'repay_time');
            $('#repay_period3').hide();
            $('#repay_period3').removeAttr('name');
            //change_lgl_time();
        }else if(repay_mode == 4 || repay_mode == 3 || repay_mode == 2 || repay_mode == 8){
            $('.xhsoi').show();
            $('.xhsot').hide();

            var repay_period = $("#repay_period3").val();
            $('#repay_period3').show();
            $('#repay_period3').attr('name', 'repay_time');
            $('#repay_period2,#tian').hide();
            $('#repay_period2').removeAttr('name');
            $('#repay_period').hide();
            $('#repay_period').removeAttr('name');
        }else{
            $('.xhsoi').show();
            $('.xhsot').hide();

            var repay_period = $("#repay_period").val();
            $('#repay_period').show();
            $('#repay_period').attr('name', 'repay_time');
            $('#repay_period2,#tian').hide();
            $('#repay_period2').removeAttr('name');
            $('#repay_period3').hide();
            $('#repay_period3').removeAttr('name');
        }

        changeRate('income_fee_rate');

        // 更新代销分期数据
        if (document.readyState == 'complete' && is_proxy_sale()) {
            update_proxy_loan_info();
        }
    }



    function getYearlyRate(){
        var number_scale_length = 5;
        var repay_mode = $('#repay_mode').val();
        var rate = parseFloat($('#annualized_rate').val());
        var loan_fee_rate = parseFloat($("input[name='loan_fee_rate']").val());
        var guarantee_fee_rate = parseFloat($("input[name='guarantee_fee_rate']").val());

        if(repay_mode == 5){
            var repay_time = $('#repay_period2').val();
        }else if(repay_mode == 4 || repay_mode == 3 || repay_mode == 2){
            var repay_time = $('#repay_period3').val();
        }else{
            var repay_time = $("#repay_period").val();
        }

        var time = 12;
        if(repay_mode == 5){
            time = 360;
        }

        if(repay_time > 0){
            var yearly_loan_fee_rate = (loan_fee_rate / repay_time * time).toFixed(number_scale_length);
            var yearly_guarantee_fee_rate = (guarantee_fee_rate / repay_time * time).toFixed(number_scale_length);
            var yearly_rate = rate+parseFloat(yearly_loan_fee_rate)+parseFloat(yearly_guarantee_fee_rate);
        }else{
            var yearly_loan_fee_rate = '';
            var yearly_guarantee_fee_rate = '';
            var yearly_rate = rate;
        }

        $('#yearly_loan_fee_rate').html(yearly_loan_fee_rate);
        $('#yearly_guarantee_fee_rate').html(yearly_guarantee_fee_rate);
        $('#yearly_rate').html(yearly_rate.toFixed(number_scale_length));
    }

    function button_edit(){
        $("#button_ff").html('<input type="submit" class="button" value="{%EDIT}" /><input type="reset" class="button" value="{%RESET}" />');
    }

    function confirmSubmit() {
        //JIRA#2925  合同变更需求，新增“资产转让类别”
        //转让资产类别数据校验,若资产转让类别选择为“无”，则此五项为非必填项。若资产转让类别选择为“债权”或“资产收益权”，则“基础合同的编号”、“原始债务人”、“基础合同交易金额”、“基础合同名称”四项为必填项
        if ( $('select[name="contract_transfer_type"]: option:selected').val() > 0) {
            $("input[name='leasing_contract_num']").addClass('require');
            $("input[name='lessee_real_name']").addClass('require');
            $("input[name='leasing_money']").addClass('require');
            $("input[name='leasing_contract_title']").addClass('require');
        } else {
            $("input[name='leasing_contract_num']").removeClass('require');
            $("input[name='lessee_real_name']").removeClass('require');
            $("input[name='leasing_money']").removeClass('require');
            $("input[name='leasing_contract_title']").removeClass('require');
        }

        income_fee_rate = parseFloat($("#income_fee_rate").val()); // 年化出借人收益率
        annualized_rate = parseFloat($("#annualized_rate").val());    // 借款年利率
        income_float_rate = parseFloat($("#income_float_rate").val()); //年化收益浮动利率
        income_base_rate = parseFloat($("#income_base_rate").val()); // 年化收益基本利率


        if(isNaN(income_base_rate)) {
            alert('年化收益基本利率不能为空');
            $("#income_base_rate").focus();
            return false;
        }

        if(income_fee_rate != annualized_rate || annualized_rate.toFixed(5) !=(income_float_rate + income_base_rate).toFixed(5)) {
            alert("请注意 ： 借款年利率＝年化出借人收益率 = (年化收益基本利率 + 年化收益浮动利率");
            return false;
        }


        var deal_status = $("input[name='deal_status']:checked").val();
        if(isP2P && deal_status==1){
            if($("input[name='report_type']:checked").val() == 0){
                return confirm("请注意： 该标是网贷类型的标的您确定不要到存管行报备么？");
            }else{
                if(hasReportToBank == false){
                    if(deal_status == 1){
                        return confirm("请注意： 确定需要将该标的报备到存管行么？");
                    }
                }
            }
        }

        var deal_type = $("#deal_type").val();
        if(deal_type == 2){
            var jys_val = $("#jys_id option:selected").val();
            if(jys_val == 0){
                $("#jys_id").focus();
                alert('请选择对应的交易所');
                return false;
            }
        }
        return true;
    }

    function edit_borrower() {
        $.weeboxs.open(ROOT+'?m=Deal&a=edit_borrower&deal_id='+{$vo.id}, {contentType:'ajax',showButton:false,title:'修改借款人',width:500,height:140});
    }

    input_change($("#total_loan_fee") , $("#loan_fee_custom .loan_fee_arr") , ".loan_fee_arr", "loan");
    input_change($("#total_consult_fee") , $("#consult_fee_custom .consult_fee_arr") , ".consult_fee_arr", "consult");
    input_change($("#total_guarantee_fee") , $("#guarantee_fee_custom .guarantee_fee_arr") , ".guarantee_fee_arr", "guarantee");
    input_change($("#total_pay_fee") , $("#pay_fee_custom .pay_fee_arr") , ".pay_fee_arr", "pay");
    input_change($("#total_management_fee") , $("#management_fee_custom .management_fee_arr") , ".management_fee_arr", "management");

    $("#loan_fee_custom .loan_fee_arr").live("input" , function(){
        input_change($("#total_loan_fee") , $(this) , ".loan_fee_arr", "loan");
    });

    $("#consult_fee_custom .consult_fee_arr").live("input" , function(){
        input_change($("#total_consult_fee") , $(this) , ".consult_fee_arr", "consult");
    });

    $("#guarantee_fee_custom .guarantee_fee_arr").live("input" , function(){
        input_change($("#total_guarantee_fee") , $(this) , ".guarantee_fee_arr", "guarantee");
    });

    $("#pay_fee_custom .pay_fee_arr").live("input" , function(){
        input_change($("#total_pay_fee") , $(this) , ".pay_fee_arr", "pay");
    });
    $("#management_fee_custom .management_fee_arr").live("input" , function(){
        input_change($("#total_management_fee") , $(this) , ".management_fee_arr", "management");
    });

    function input_change ($total , $t ,str, type) {
        var num=0;
        var whole = $("#"+type+"_fee").html();
        $t.parents("table").find(str).each(function(){
            num += parseFloat(this.value);
            if (whole > 0) {
                var p = this.value / whole * 100;
            } else {
                var p = 100;
            }
            $(this).parent().parent().find("."+type+"_p").html(p.toFixed(5)+"%");
        });

        $total.html(num.toFixed(2));

        if (whole > 0) {
            var pt = num / whole * 100;
        } else {
            var pt = 100;
        }
        $("#total_"+type+"_p").html(pt.toFixed(5)+"%");
    }

    function chg_fee() {
        chg_loan_fee();
        chg_consult_fee();
        chg_guarantee_fee();
        chg_canal_fee();
        chg_pay_fee();
        chg_management_fee();
    }

    function chg_loan_fee() {
        var type = $('input:radio[name="loan_fee_rate_type"]:checked').val();
        if (type!=3 || type != 4) {
            $("#loan_fee_custom").hide();
        }
        if (type==3 || type == 4 || type == 7) {
            $("#loan_fee_custom").show();
        }
    }
    function chg_consult_fee() {
        var type = $('input:radio[name="consult_fee_rate_type"]:checked').val();
        if (type!=3) {
            $("#consult_fee_custom").hide();
        }
        if (type==3) {
            $("#consult_fee_custom").show();
        }
    }
    function chg_guarantee_fee() {
        var type = $('input:radio[name="guarantee_fee_rate_type"]:checked').val();
        if (type!=3) {
            $("#guarantee_fee_custom").hide();
        }
        if (type==3) {
            $("#guarantee_fee_custom").show();
        }
    }
    function chg_canal_fee() {
        var type = $('input:radio[name="canal_fee_rate_type"]:checked').val();
        if (type!=3) {
            $("#canal_fee_custom").hide();
        }
        if (type==3) {
            $("#canal_fee_custom").show();
        }
    }
    function chg_pay_fee() {
        var type = $('input:radio[name="pay_fee_rate_type"]:checked').val();
        if (type!=3) {
            $("#pay_fee_custom").hide();
        }
        if (type==3) {
            $("#pay_fee_custom").show();
        }
    }
    function chg_management_fee() {
        var type = $('input:radio[name="management_fee_rate_type"]:checked').val();
        if (type!=3) {
            $("#management_fee_custom").hide();
        }
        if (type==3) {
            $("#management_fee_custom").show();
        }
    }
    //修改“平台费折扣率”时，提示不能输入大于100%
    function changeDiscountRate(){
      var rate = Number($('input:text[id="discount_rate"]').val());
      if(isNaN(rate) || (rate > 100.00) || (0 > rate)) {
          $('input:text[id="discount_rate"]').val("100.00000");
          alert("平台费折扣率只能是数值，不能超过100%，且不能小于0");
      }
    }

    // onclick 事件响应函数
    // 点击 loan_fee_rate_type
    function cli_loan_fee(obj)
    {
        // loan_fee_type 与 pay_type 对应值关系
        var fee_pay_hash = new Array();
        fee_pay_hash[1] = 0; // 年化前收 -> 放款时结算
        fee_pay_hash[2] = 1; // 年化后收 -> 还清时结算
        fee_pay_hash[3] = 1; // 年化分期收 -> 还清时结算
        fee_pay_hash[4] = 0; // 代销分期 -> 放款时结算
        fee_pay_hash[5] = 0; // 固定比例前收 -> 放款时结算
        fee_pay_hash[6] = 1; // 固定比例后收 -> 还清时结算
        fee_pay_hash[7] = 0; // 固定比例分期收 -> 放款时结算

        var pay_type_objs = $("input.pay_type");
        for (var i = pay_type_objs.length - 1; i >= 0; --i) {
            if (pay_type_objs[i].value == fee_pay_hash[obj.value]) {
                pay_type_objs[i].checked = true;
            } else {
                pay_type_objs[i].checked = false;
            }
        }
        calc_fenqi_fee("loan_fee");
    }

    // 点击 deal_status
    function cli_deal_status(obj)
    {
        if (0 == obj.value || 1 == obj.value) {
            $("input#rebate_days")[0].readOnly = true;
        } else {
            $("input#rebate_days")[0].readOnly = false;
        }
    }

    // 年化借款平台手续费 - 不同情况切换
    $('#loan_fee_type_1').click(function () {
        update_loan_fee(1);
    });
    $('#loan_fee_type_2').click(function () {
        update_loan_fee(2);
    });
    $('#loan_fee_type_3').click(function () {
        $('#loan_fee_custom_input').html($('#loan_fee_installment').html());
        update_loan_fee(3);
    });
    $('#loan_fee_type_4').click(function () {
        $('#loan_fee_custom_input').html($('#loan_fee_proxy').html());
        update_loan_fee(4);
    });
    $('#loan_fee_type_5').click(function () {
        update_loan_fee(5);
    });
    $('#loan_fee_type_6').click(function () {
        update_loan_fee(6);
    });
    $('#loan_fee_type_7').click(function () {
        $('#loan_fee_custom_input').html($('#loan_fee_installment').html());
        update_loan_fee(7);
    });

    // 更新代销分期 收益率 和 金额
    function update_proxy_loan_info()
    {
        if ($('#loan_fee_type_4').attr('checked')) {
            var repay_mode = $('#repay_mode').val();

            if(repay_mode == 5){
                var repay_time = $('#repay_period2').val();
            }else if(repay_mode == 4 || repay_mode == 3 || repay_mode == 2){
                var repay_time = $('#repay_period3').val();
            }else{
                var repay_time = $('#repay_period').val();
            }

            $.post(
                '/m.php?m=Ajax&a=getPeriodInfo',
                {"loantype" : repay_mode,
                 "loan_fee_rate" : $('#loan_fee_rate').val(),
                 "repay_time" : repay_time,
                 "loan_money" : $("#apr").val(),
                 "loan_first_rate" : $('#proxy_loan_fee_rate_first').val()},
                function (data) {
                    $('#proxy_loan_fee_first').val(data.loan_first_fee);
                    $('#proxy_loan_fee_rate_last').val(data.loan_last_rate);
                    $('#proxy_loan_fee_last').val(data.loan_last_fee);

                    $('#proxy_loan_rate_sum').val(data.loan_rate_sum);
                    $('#proxy_loan_fee_sum').val(data.loan_fee_sum);
                },
                'json'
            );
        }
    }

    // 判断是否为代销分期
    function is_proxy_sale()
    {
        return $('#loan_fee_type_4').attr('checked');
    }

    // 更新平台手续费金额
    function update_loan_fee(loan_fee_rate_type)
    {
        $.post(
            '/m.php?m=Ajax&a=getLoanFee',
            {
                "deal_id" : $('#deal_id').val(),
                "loan_fee_rate_type" : loan_fee_rate_type
            },
            function (data) {
                $('#total_loan_fee').html(data.fee);
                $('#loan_fee').html(data.fee);
                $("input[name=loan_fee_arr[0]]").val(data.fee);
            },
            'json'
        );
    }

    //渠道费显示
    function change_canal(selectstr){
        if(selectstr == "0"){
            canal_fee_info.style.display = "none";
        }else{
            canal_fee_info.style.display = "";
        }
    }

</script>
<include file="Public:footer" />

<!-- 平台手续分 分期收-->
<script type="text/html" id="loan_fee_installment">
    &nbsp;&nbsp;&nbsp;&nbsp;应收金额：<span id="loan_fee">{$loan_fee}</span>&nbsp;&nbsp;&nbsp;&nbsp;应收比例：100% <br/><br/>
    <table class="form" cellpadding=0 cellspacing=0>
        <tr>
            <td width="100px">期次</td><td width="150px">金额(元)</td><td>比例</td>
        </tr>
        <if condition="$deal_ext.loan_fee_ext eq ''">
            <tr>
                <td>0 (起息日)</td><td><input type='text' name='loan_fee_arr[0]' class='loan_fee_arr' id='loan_fee_arr[]' value='{$loan_fee}' /></td><td class='loan_p'>100%</td>
            </tr>
            <php>
                for ($i=1;$i<=$repay_times;$i++) {
                echo "<tr><td>".$i."</td><td><input type='text' class='loan_fee_arr' name='loan_fee_arr[".$i."]' id='loan_fee_arr[]' value='0.00' /></td><td class='loan_p'>0%</td></tr>";
                }
            </php>
            <else/>
            <php>
                $loan_fee_arr = json_decode($deal_ext['loan_fee_ext'], true);
                foreach ($loan_fee_arr as $kk => $vv) {
                if ($kk == 0) {
                echo "<tr><td>0 (起息日)</td>";
                } else {
                echo "<tr><td>".$kk."</td>";
                }
                echo "<td><input type='text' class='loan_fee_arr' name='loan_fee_arr[".$kk."]' id='loan_fee_arr[]' value='".$vv."' /></td><td class='loan_p'>0%</td></tr>";
                }
            </php>
        </if>
        <tr>
            <td>总计</td><td><span id="total_loan_fee">{$loan_fee}</span></td><td id="total_loan_p">100%</td>
        </tr>
    </table>
</script>

<!-- 平台手续分 代销分期-->
<script type="text/html" id="loan_fee_proxy">
    <table class="form" cellpadding="0" cellspacing="0">
        <tr>
            <td width="100px">期次</td>
            <td width="150px">年华收益率(%)</td>
            <td>应收金额(元)</td>
        </tr>
        <tr>
            <td>(起息日)</td>
            <td><input type='text' name='proxy_loan_fee_rate_first' id='proxy_loan_fee_rate_first' onchange='update_proxy_loan_info()' value='{$proxy_sale.loan_first_rate}'/></td>
            <td class='loan_p'><input type="text" name='loan_fee_arr[]' id='proxy_loan_fee_first' class='loan_fee_arr' readonly='true' value='{$loan_fee_arr[0]}'></td>
        </tr>
        <tr>
            <td>(最后一期)</td>
            <td><input type='text' name='proxy_loan_fee_rate_last' id='proxy_loan_fee_rate_last' readonly='true' value='{$proxy_sale.loan_last_rate}'/></td>
            <td class='loan_p'><input type="text" name='loan_fee_arr[]' id='proxy_loan_fee_last' class='loan_fee_arr' readonly='true' value='{$loan_fee_arr[$repay_times]}'></td>
        </tr>
        <tr>
            <td>总计</td>
            <td><input type='text' id='proxy_loan_rate_sum' readonly='true' value='{$proxy_sale.loan_rate_sum}'/></td>
            <td><input type='text' id='proxy_loan_fee_sum' readonly='true' value='{$proxy_sale.loan_fee_sum}'/></td>
        </tr>
    </table>
</script>
