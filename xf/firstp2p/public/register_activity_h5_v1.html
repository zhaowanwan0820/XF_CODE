<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
        <title>注册 - 网信理财</title>
        <script>
            var _STATIC_VERSION = '201507211440';
            var _STATIC_PATH = (/firstp2plocal/).test(window.location.host) ?  '/static' : '//assets.firstp2p.com';
            function _warpstaticpath(relativepath) {
                 return _STATIC_PATH + "/" + relativepath + "?v=" + _STATIC_VERSION;
            }
            (function(){
                document.write('<link rel="apple-touch-icon-precomposed" href="' + _warpstaticpath('skins/default/images/favicon.png') + '"/>');
                document.write('<link rel="shortcut icon" type="image/x-icon" href="' + _warpstaticpath('skins/default/images/favicon.png') + '"/>');
                document.write('<link href="' + _warpstaticpath('v1/css/oauth/mobile/m-base.css') + '" rel="stylesheet" type="text/css"/>');
                document.write('<link href="' + _warpstaticpath('v1/css/oauth/mobile/m-common.css') + '" rel="stylesheet" type="text/css"/>');
                document.write('<link href="' + _warpstaticpath('v1/css/oauth/mobile/p-user-register.css') + '" rel="stylesheet" type="text/css"/>');
                document.write('<script src="' + _warpstaticpath('v1/js/risk/frms-fingerprint-min.js') + '"><\/script>');
                document.write('<script src="' + _warpstaticpath('v1/js/oauth/mobile/zepto.js') + '"><\/script>');
                document.write('<script src="' + _warpstaticpath('v1/js/oauth/mobile/common.js') + '"><\/script>');
            })();
        </script>
    </head>
    <body>
        <header class="m-head">
            <div class="m-head-fix" style="position:static;">
                <div class="head_app">
                    <span>下载APP客户端进行投资</span> <a class="down_btn" href="http://app.firstp2p.com/">下载</a> <span class="close">
                    </span>
                </div>
                <div class="logo_menu clearfix">
                    <a class="logo" href="javascript:void(0);"></a><a href="http://m.firstp2p.com/account/login" class="top-memu">登录</a>
                </div>
            </div>
            <div class="m-head-placeholder" style="display:none;">
            </div>
        </header>
        <section class="m-main p_user_register">
            <span class="blank20"></span>
            <div class="ui-form">
                <form id="register_form" name="register_form" method="POST" action="/user/doRegister?type=h5&client_id=7b9bd46617b3f47950687351&redirect_uri=http%3A%2F%2Fm.firstp2p.com%2Faccount%2Flogin%3Ffrom_register%3D1&from_platform=wap">
                    <input id="telCode" type="hidden" name="code" value="" />
                    <input type="hidden" name="type" value="h5" />
                    <input type="hidden" name="active" value="1" />
                    <input type="hidden" name="agreement" value="1" />
                    <div class="dl_center">
                        <div class="input-list">
                            <div class="tel-select">中国<span>+86</span></div>
                            <div class="txt-wrap pl10">
                                <input id="mobile" type="tel" name="mobile" placeholder="手机号码（用于接收验证码）" />
                            </div>
                        </div>
                        <div class="input-list clearfix">
                            <div class="txt-wrap">
                                <input id="password" type="password" name="password" placeholder="登录密码（5~25位，不支持空格）" />
                            </div>
                        </div>
                        <div class="input-list disbor">
                            <div class="txt-wrap">
                                <input id="invite" type="text" placeholder="邀请码（选填）" name="invite" value=""/>
                            </div>
                        </div>
                        <div class="input-list">
                            <div class="txt-wrap">
                                <input id="captcha" class="img-yanzheng" type="text" placeholder="右侧数字" name="captcha" />
                            </div>
                            <div class="dl_yanzhengma">
                                <img title="验证码图片" alt="验证码图片" src="" />
                                <span class="blue">换一张</span>
                            </div>
                        </div>
                    </div>
                    <div class="dl_footer">
                        <input type="button" id="register_btn" value="完成注册" />
                        <h3>同意<a class="blue" href="/register_terms_h5.html">《网信理财用户协议》</a></h3>
                    </div>
                </form>
                <ul class="security">
                    <li><i class="common-sprite"></i><span>12%-14预期<br/>年化收益</span></li>
                    <li><i class="common-sprite"></i><span>100%本息保障<br/>计划</span></li>
                    <li><i class="common-sprite"></i><span>第三方<br/>账户托管</span></li>
                </ul>
            </div>
        </section>
        <footer class="m-foot">
            <div class="copyright">北京东方联合投资管理有限公司</div>
            <div class="copyright">&copy;2015 网信理财 All rights reserved 京ICP证130046号 </div>
        </footer>
        <script type="text/javascript">
        (function(){var mobilematches = /[?&]mobile=([0-9]*)/.exec(window.location.search);
        if (mobilematches && mobilematches[1]) {
            $("#mobile").val(mobilematches[1])
        }})();
        var app_close_expires = 3;
        if(localStorage.getItem('app_close')){
            var timeGap = (new Date()).getTime() - localStorage.getItem('app_close_timestamp');
            if(timeGap > app_close_expires*3600*24*1000){
                document.querySelector('.m-head').classList.remove('down_app_none');
                localStorage.setItem('app_close',false);
            }else{
                document.querySelector('.m-head').classList.add('down_app_none');
            }
        }
        document.querySelector('.head_app .close').onclick = function(e) {
            document.querySelector('.m-head').classList.add('down_app_none');
            localStorage.setItem('app_close',true);
            localStorage.setItem('app_close_timestamp',(new Date()).getTime());
        };
        $(function(){
            var _inMcodeRequest = false;
            // 按钮disable状态逻辑
            function upateSubmitButton() {
                var disabled = _inMcodeRequest || $('#mobile').val() == '' || $('#password').val() == '' || $('#captcha').val() == '';
                if (disabled) {
                    $('#register_btn').attr('disabled', 'disabled');
                } else {
                    $('#register_btn').removeAttr('disabled');
                }
            }
            $('#mobile').bind("input", upateSubmitButton);
            $('#password').bind("input", upateSubmitButton);
            $('#captcha').bind("input", upateSubmitButton);
            var _upateSubmitButtonCount = 10;
            var _upateSubmitButtonTimer = setInterval(function(){
                upateSubmitButton();
                _upateSubmitButtonCount--;
                if (_upateSubmitButtonCount < 0) {
                    clearInterval(_upateSubmitButtonTimer);
                }
            }, 300);

            // 图片验证码逻辑
            function updateCaptchaImg() {
                $('.dl_yanzhengma img').attr('src', '/verify.php?w=40&h=20&rb=0&rand=' + new Date().valueOf());
            }
            $('.dl_yanzhengma').click(function() {
                updateCaptchaImg();
            });
            updateCaptchaImg();

            // 显隐密码
            var _pwdFlag = false;
            function updatePassWordStyle(show) {
                $('#password')[0].type = show ? 'text' : 'password';
                $('#pwd_show_btn')[0].innerHTML = show ? '隐藏' : '显示';
            }
            $('#pwd_show_btn').bind("click", function(){
                _pwdFlag = !_pwdFlag;
                updatePassWordStyle(_pwdFlag);
            });

            // step1
            $('#register_btn').click(function(event) {
                if (_inMcodeRequest) return;
                // 手机号
                if(!P2PWAP.common.checkMobile($('#mobile')[0])){
                    return;
                }
                // 密码
                if(!P2PWAP.common.checkPassword($('#password')[0])){
                    return;
                }
                // 验证码
                if(!P2PWAP.common.checkCaptcha($('#captcha')[0])){
                    return;
                }
                getMCode();
                // 获取手机验证码
                function getMCode(){
                    _inMcodeRequest = true;
                    upateSubmitButton();
                    P2PWAP.util.ajax('/user/MCode', 'post', function(obj){
                        _inMcodeRequest = false;
                        upateSubmitButton();
                        if (obj.code == 1){
                            var sendingAjax;
                            $('body').append('<div class="ui-popup-wrap"></div>');
                            var html= '';
                            html += '<div class="ui-pop-box reg_send_box" style="margin-top:-122px;top:50%">';
                            html += '    <div class="pop-head">';
                            html += '        <h1>填写短信验证码</h1>';
                            html += '        <div class="pop_close"></div>';
                            html += '    </div>';
                            html += '    <div class="pop-body">';
                            html += '        <p class="tc">已向'+ $('#mobile').val().replace(/(\d{3})\d{4}(\d{4})/, function(_0, _1, _2) {return _1 + "****" + _2}) +'发送验证短信</p>';
                            html += '        <div class="pop-form">';
                            html += '            <form id="" name="" method="POST" onsubmit="return false;">';
                            html += '                <div class="form_mid">';
                            html += '                    <div class="ipt-list">';
                            html += '                        <div class="txt-wrap">';
                            html += '                            <input id="telCaptcha" class="img-yanzheng" type="text" maxlength="6" placeholder="短信验证码" name="telCaptcha">';
                            html += '                        </div>';
                            html += '                        <div class="resend"><input id="action-send-code" type="button" class="re-btn blue sending" value="正在获取中" disabled="disabled"/></div>';
                            html += '                    </div>';
                            html += '                </div>';
                            html += '                <div class="btn-wrap">';
                            html += '                    <input id="telCodeSendBtn" class="pop-btn btn-ok" type="button" value="完成" />';
                            html += '                </div>';
                            html += '            </form>';
                            html += '        </div>';
                            html += '    </div>';
                            html += '</div>';
                            $('.ui-popup-wrap').html(html);
                            P2PWAP.ui.updateTimeLabel($('#action-send-code')[0],125);
                            P2PWAP.ui.btnDisableType([$('#telCaptcha')[0]], $('#telCodeSendBtn')[0]);

                            $('.ui-popup-wrap .pop_close').click(function(event) {
                                if(sendingAjax) sendingAjax.abort();
                                $('.ui-popup-wrap').remove();
                            });

                            $('#action-send-code').click(function(event) {
                                var $this = $(this);
                                $this.addClass('sending').attr('disabled','disabled');
                                sendingAjax = P2PWAP.util.ajax('/user/MCode', 'post', function(obj){
                                    if (obj.code == 1){
                                        P2PWAP.ui.updateTimeLabel($('#action-send-code')[0],125);
                                    } else {
                                        P2PWAP.ui.showErrorTip(obj.message);
                                         $this.removeClass('sending').removeAttr('disabled');
                                    }
                                    sendingAjax = null;
                                }, function(msg){
                                    P2PWAP.ui.showErrorTip(msg);
                                    sendingAjax = null;
                                }, {
                                    type: '1',
                                    isrsms: '0',
                                    t: new Date().getTime(),
                                    mobile: $('#mobile').val(),
                                    captcha: $('#captcha').val(),
                                    active: '1'
                                });
                            });

                            $('#telCodeSendBtn').click(function(event) {
                                var val = $('#telCaptcha').val();
                                if (!/^\d{6}$/.test(val)) {
                                    P2PWAP.ui.showErrorTip('请填写6位数字验证码');
                                } else {
                                    $('#telCode').val(val);
                                    $('#register_form').submit();
                                }
                            });
                        } else {
                            P2PWAP.ui.showErrorTip(obj.message);
                        }
                    }, function(msg){
                        _inMcodeRequest = false;
                        upateSubmitButton();
                        P2PWAP.ui.showErrorTip(msg);
                    }, {
                        type: '1',
                        isrsms: '0',
                        t: new Date().getTime(),
                        mobile: $('#mobile').val(),
                        captcha: $('#captcha').val(),
                        active: '1'
                    });
                }
            });
        });
        </script>


        <script type='text/javascript'>
            var _ncf = {"prd": "firstp2p", "pstr": "", "pfunc": null, "pcon": "", "pck": {"channel": "channel", "fpid": "fpid"}, "trid": "", "channel": ['pubid', 'mediumid', 'adid', 'adsize'], "rfuniq": [], "rfmuti": []};
            (function(p, h, s) {
                var o = document.createElement(h);
                o.src = s;
                p.appendChild(o)
            })(document.getElementsByTagName("HEAD")[0], "script", _warpstaticpath("default/js/ncfpb.1.5.min.js"));
        </script>

        <!-- Menlo PV Tracking Code Start -->
        <script type="text/javascript">
            MLTrackerz = {mid: 250582, ers: [{'type': 'pageview'}], track: function(er) {
                this.ers.push(er);
            }};
            (function() {
                var js = document.createElement('script'), scri = document.getElementsByTagName('script')[0];
                js.type = 'text/javascript';
                js.async = true;
                js.src = location.protocol == 'https:' ? 'https://secure.mlt01.com/mltz.js' : 'http://static.mlt01.com/mltz.js';
                scri.parentNode.insertBefore(js, scri);
            })();
        </script>
        <!-- Menlo PV Tracking Code End -->
        <!-- Menlo Event Tracking Code Start -->
        <!-- Event: Firstp2pHTK -->
        <script type="text/javascript">
            MLTrackerz.track({type: 'event', action: 'Firstp2pHTK'});
        </script>
        <!-- Menlo Event Tracking Code End -->
            </body>
</html>
